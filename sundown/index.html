<!DOCTYPE html>
<!--[if lte IE 8]> <html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html> <!--<![endif]-->
<head>
<meta charset="utf-8">
<!--
Made in Twine 1.4.1 (running on Darwin 13.2.0)
Built on 20 Jun 2014 at 13:29:36, -0400

Sugarcane is based on:

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<title>Sugarcane</title>
<script title="engine">
(function(){

function clone(a){var b={};if(!a||typeof a!="object"){return a}for(var property in a){if(typeof a[property]=="object"){try{b[property]=JSON.parse(JSON.stringify(a[property]));continue}catch(e){}}b[property]=a[property]}return b}function insertElement(a,d,f,c,e){var b=document.createElement(d);if(f){b.id=f}if(c){b.className=c}if(e){insertText(b,e)}if(a){a.appendChild(b)}return b}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}function findPassageParent(el){while(el&&el!=document.body&&!~el.className.indexOf("passage")){el=el.parentNode}return el==document.body?null:el}function setPageElement(c,b,a){var place;if(place=(typeof c=="string"?document.getElementById(c):c)){removeChildren(place);if(tale.has(b)){new Wikifier(place,tale.get(b).processText())}else{new Wikifier(place,a)}}}function addStyle(b){if(document.createStyleSheet){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+b+"</style>")}else{var a=document.createElement("style");a.appendChild(document.createTextNode(b));document.getElementsByTagName("head")[0].appendChild(a)}}function alterCSS(text){var imgPassages=tale.lookup("tags","Twine.image");text=text.replace(/\/\*(?:[^\*]|\*(?!\/))*\*\//g,"");text=text.replace(/:link/g,"[class*=Link]");text=text.replace(/:visited/g,".visitedLink");return text.replace(new RegExp(Wikifier.imageFormatter.lookahead,"gim"),function(m,p1,p2,p3,src){for(var i=0;i<imgPassages.length;i++){if(imgPassages[i].title==src){src=imgPassages[i].text;break}}return"url("+src+")"})}function setTransitionCSS(styleText){styleText=alterCSS(styleText);var style=document.getElementById("transitionCSS");style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText)}function throwError(a,b,tooltip){if(a){var elem=insertElement(a,"span",null,"marked",b);tooltip&&elem.setAttribute("title",tooltip)}}Math.easeInOut=function(a){return(1-((Math.cos(a*Math.PI)+1)/2))};String.prototype.readMacroParams=function(keepquotes){var exec,re=/(?:\s*)(?:(?:"([^"]*)")|(?:'([^']*)')|(?:\[\[((?:[^\]]|\](?!\]))*)\]\])|([^"'\s]\S*))/mg,params=[];do{var val;exec=re.exec(this);if(exec){if(exec[1]){val=exec[1];keepquotes&&(val='"'+val+'"')}else{if(exec[2]){val=exec[2];keepquotes&&(val="'"+val+"'")}else{if(exec[3]){val=exec[3];keepquotes&&(val='"'+val.replace('"','\\"')+'"')}else{if(exec[4]){val=exec[4]}}}}val&&params.push(val)}}while(exec);return params};String.prototype.readBracketedList=function(){var c,b="\\[\\[([^\\]]+)\\]\\]",a="[^\\s$]+",e="(?:"+b+")|("+a+")",d=new RegExp(e,"mg"),f=[];do{c=d.exec(this);if(c){if(c[1]){f.push(c[1])}else{if(c[2]){f.push(c[2])}}}}while(c);return(f)};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});String.prototype.unDash=function(){var s=this.split("-");if(s.length>1){for(var t=1;t<s.length;t++){s[t]=s[t].substr(0,1).toUpperCase()+s[t].substr(1)}}return s.join("")};Array.prototype.indexOf||(Array.prototype.indexOf=function(b,d){d=(d==null)?0:d;var a=this.length;for(var c=d;c<a;c++){if(this[c]==b){return c}}return -1});(function(){function t(t){this.message=t}var e=window,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=Error(),t.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var o,n,a=0,i=r,c="";e.charAt(0|a)||(i="=",a%1);c+=i.charAt(63&o>>8-8*(a%1))){if(n=e.charCodeAt(a+=0.75),n>255){throw new t()}o=o<<8|n}return c}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4){throw new t()}for(var o,n,a=0,i=0,c="";n=e.charAt(i++);~n&&(o=a%4?64*o+n:n,a++%4)?c+=String.fromCharCode(255&o>>(6&-2*a)):0){n=r.indexOf(n)}return c})})();var hasTransition="transition" in document.documentElement.style||"-webkit-transition" in document.documentElement.style;function fade(f,c){var h;var e=f.cloneNode(true);var g=(c.fade=="in")?1:-1;f.parentNode.replaceChild(e,f);if(c.fade=="in"){h=0;e.style.visibility="visible"}else{h=1}b(e,h);var a=window.setInterval(d,25);function d(){h+=0.05*g;b(e,Math.easeInOut(h));if(((g==1)&&(h>=1))||((g==-1)&&(h<=0))){f.style.visibility=(c.fade=="in")?"visible":"hidden";if(e.parentNode){e.parentNode.replaceChild(f,e)}window.clearInterval(a);if(c.onComplete){c.onComplete.call(f)}}}function b(k,j){var l=Math.floor(j*100);k.style.zoom=1;k.style.filter="alpha(opacity="+l+")";k.style.opacity=j}}var scrollWindowInterval;function scrollWindowTo(e){var d=window.scrollY?window.scrollY:document.documentElement.scrollTop,g=k(e),c=Math.abs(d-g),b=0,j=(d>g)?-1:1;scrollWindowInterval=window.setInterval(h,25);function h(){b+=0.1;window.scrollTo(0,d+j*(c*Math.easeInOut(b)));if(b>=1){window.clearInterval(scrollWindowInterval)}}function k(o){var p=a(o);var q=p+o.offsetHeight;var l=window.scrollY?window.scrollY:document.documentElement.scrollTop;var m=window.innerHeight?window.innerHeight:document.documentElement.clientHeight;var n=l+m;if(p<l){return p}else{if(q>n){if(o.offsetHeight<m){return(p-(m-o.offsetHeight)+20)}else{return p}}else{return p}}}function a(l){var m=0;while(l.offsetParent){m+=l.offsetTop;l=l.offsetParent}return m}}function delta(old,neu){var vars,ret={};if(old&&neu){for(vars in neu){if(neu[vars]!==old[vars]){ret[vars]=neu[vars]}}}return ret}function History(){this.history=[{passage:null,variables:{}}];this.id=new Date().getTime()+""}History.prototype.encodeHistory=function(b,noVars){var ret=".",vars,type,hist=this.history[b],d=this.history[b+1]?delta(this.history[b+1].variables,hist.variables):hist.variables;function vtob(str){try{return window.btoa(unescape(encodeURIComponent(JSON.stringify(str))))}catch(e){return"0"}}if(!hist.passage||hist.passage.id==null){return""}ret+=hist.passage.id.toString(36);if(noVars){return ret}for(vars in d){type=typeof d[vars];if(type!="function"&&type!="undefined"){ret+="$"+vtob(vars)+","+vtob(d[vars])}}for(vars in hist.linkVars){type=typeof hist.linkVars[vars];if(type!="function"&&type!="undefined"){ret+="["+vtob(vars)+","+vtob(hist.linkVars[vars])}}return ret};History.prototype.decodeHistory=function(str,prev){var name,splits,variable,c,d,ret={variables:clone(prev.variables)||{}},match=/([a-z0-9]+)((?:\$[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)((?:\[[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)/g.exec(str);function btov(str){try{return JSON.parse(decodeURIComponent(escape(window.atob(str))))}catch(e){return 0}}if(match){name=parseInt(match[1],36);if(!tale.has(name)){return false}if(match[2]){ret.variables||(ret.variables={});splits=match[2].split("$");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.variables[d]=btov(variable[1])}}}if(match[3]){ret.linkVars||(ret.linkVars={});splits=match[3].split("[");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.linkVars[d]=btov(variable[1])}}}ret.passage=tale.get(name);return ret}};History.prototype.save=function(c){var hist,b,a="";for(b=this.history.length-1;b>=0;b--){hist=this.history[b];if(!hist){break}a+=this.encodeHistory(b)}return"#"+a};History.prototype.restore=function(){var a,b,c,vars;try{if(testplay){this.display(testplay,null,"quietly");return true}if(!window.location.hash||(window.location.hash=="#")){return false}if(window.location.hash.substr(0,2)=="#!"){c=window.location.hash.substr(2).split("_").join(" ");this.display(c,null,"quietly");return true}a=window.location.hash.replace("#","").split(".");for(b=0;b<a.length;b++){vars=this.decodeHistory(a[b],vars||{});if(vars){if(b==a.length-1){vars.variables=clone(this.history[0].variables);for(c in this.history[0].linkVars){vars.variables[c]=clone(this.history[0].linkVars[c])}this.history.unshift(vars);this.display(vars.passage.title,null,"back")}else{this.history.unshift(vars)}}}return true}catch(d){return false}};History.prototype.saveVariables=function(c,el,callback){this.history.unshift({passage:c,variables:clone(this.history[0].variables)});if(typeof callback=="function"){callback.call(el);this.history[1]&&(this.history[1].linkVars=delta(this.history[1].variables,this.history[0].variables))}};var restart=History.prototype.restart=function(){if(typeof window.history.replaceState=="function"){this.pushState(true,window.location.href.replace(/#.*$/,""));window.location.reload()}else{window.location.hash=""}};var version={major:4,minor:1,revision:0,date:new Date("January 1, 2013"),extensions:{}};var testplay,tale,state,prerender={},postrender={},macros=window.macros={};version.extensions.displayMacro={major:2,minor:0,revision:0};macros.display={parameters:[],handler:function(place,macroName,params,parser){var t,j,output,oldDisplayParams,name=parser.fullArgs();if(macroName!="display"){output=macroName;params=name.readMacroParams(true);try{for(j=0;j<params.length;j++){params[j]=eval(Wikifier.parse(params[j]))}}catch(e){throwError(place,"<<"+macroName+" "+name+">> bad argument: "+params[j],parser.fullMatch());return}}else{try{output=eval(name)}catch(e){}if(output==null){if(tale.has(name)){output=name}else{throwError(place,"<<"+macroName+">> bad expression: "+e.message,parser.fullMatch());return}}}if(!output){throwError(place,'"'+name+'" did not evaluate to a passage name',parser.fullMatch())}else{if(!tale.has(output+"")){throwError(place,'The "'+output+'" passage does not exist',parser.fullMatch())}else{oldDisplayParams=this.parameters;this.parameters=params;t=tale.get(output+"");if(t.tags.indexOf("script")>-1){scriptEval(t)}else{new Wikifier(place,t.processText())}this.parameters=oldDisplayParams}}}};version.extensions.actionsMacro={major:1,minor:2,revision:0};macros.actions={handler:function(a,f,g){var v=state.history[0].variables,e=insertElement(a,"ul");if(!v["actions clicked"]){v["actions clicked"]={}}for(var b=0;b<g.length;b++){if(v["actions clicked"][g[b]]){continue}var d=insertElement(e,"li");var c=Wikifier.createInternalLink(d,g[b],(function(link){return function(){state.history[0].variables["actions clicked"][link]=true}}(g[b])));insertText(c,g[b])}}};version.extensions.printMacro={major:1,minor:1,revision:1};macros.print={handler:function(place,macroName,params,parser){try{var args=parser.fullArgs(macroName!="print"),output=eval(args);if(output!=null&&(typeof output!="number"||!isNaN(output))){new Wikifier(place,output.toString())}}catch(e){throwError(place,"<<print>> bad expression: "+e.message,parser.fullMatch())}}};version.extensions.setMacro={major:1,minor:1,revision:0};macros.set={handler:function(a,b,c,parser){macros.set.run(a,parser.fullArgs(),parser)},run:function(a,expression,parser){try{return eval(expression)}catch(e){throwError(a,"bad expression: "+e.message,parser?parser.fullMatch():expression)}}};version.extensions.ifMacros={major:2,minor:0,revision:0};macros["if"]={handler:function(place,macroName,params,parser){var conditions=[],clauses=[],srcOffset=parser.source.indexOf(">>",parser.matchStart)+2,src=parser.source.slice(srcOffset),endPos=-1,currentCond=parser.fullArgs(),currentClause="",t=0,nesting=0;for(var i=0;i<src.length;i++){if(src.substr(i,9)=="<<endif>>"){nesting--;if(nesting<0){endPos=srcOffset+i+9;conditions.push(currentCond.trim());clauses.push(currentClause);break}}if((src.substr(i,6)=="<<else")&&!nesting){conditions.push(currentCond.trim());clauses.push(currentClause);currentClause="";t=src.indexOf(">>",i+6);if(src.substr(i+6,4)==" if "||src.substr(i+6,3)=="if "){currentCond=Wikifier.parse(src.slice(i+9,t))}else{currentCond="true"}i=t+2}if(src.substr(i,5)=="<<if "){nesting++}currentClause+=src.charAt(i)}try{if(endPos!=-1){parser.nextMatch=endPos;for(i=0;i<clauses.length;i++){if(eval(conditions[i])){new Wikifier(place,clauses[i]);break}}}else{throwError(place,"can't find matching endif",parser.fullMatch())}}catch(e){throwError(place,"<<if>> bad condition: "+e.message,!i?parser.fullMatch():"<<else if "+conditions[i]+">>")}}};macros["else"]=macros.elseif=macros.endif={handler:function(){}};version.extensions.rememberMacro={major:2,minor:0,revision:0};macros.remember={handler:function(place,macroName,params,parser){var variable,value,re,match,statement=params.join(" ");macros.set.run(place,parser.fullArgs());if(!window.localStorage){throwError(place,"<<remember>> can't be used "+(window.location.protocol=="file:"?" by local HTML files ":"")+" in this browser.",parser.fullMatch());return}re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1];value=state.history[0].variables[variable];try{value=JSON.stringify(value)}catch(e){throwError(place,"can't remember $"+variable+" ("+(typeof value)+")",parser.fullMatch());return}window.localStorage[this.prefix+variable]=value}},init:function(){var i,variable,value;if(tale.has("StoryTitle")){this.prefix="Twine."+tale.title+"."}else{this.prefix="Twine.Untitled Story."}for(i in window.localStorage){if(i.indexOf(this.prefix)==0){variable=i.substr(this.prefix.length);value=window.localStorage[i];try{value=JSON.parse(value);state.history[0].variables[variable]=value}catch(e){}}}},expire:null,prefix:null};version.extensions.forgetMacro={major:1,minor:0,revision:0};macros.forget={handler:function(place,macroName,params){var re,match,variable,statement=params.join(" ");re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1]+"";delete state.history[0].variables[variable];delete window.localStorage[macros.remember.prefix+variable]}}};version.extensions.SilentlyMacro={major:1,minor:1,revision:0};macros.nobr=macros.silently={handler:function(place,macroName,f,parser){var i,h=insertElement(null,"div"),k=parser.source.indexOf(">>",parser.matchStart)+2,a=parser.source.slice(k),d=-1,c="",l=0;for(i=0;i<a.length;i++){if(a.substr(i,macroName.length+7)=="<<end"+macroName+">>"){if(l==0){d=k+i+macroName.length+7;break}else{l--}}else{if(a.substr(i,macroName.length+4)=="<<"+macroName+">>"){l++}}if(macroName=="nobr"&&a.charAt(i)=="\n"){c+="\u200c"}else{c+=a.charAt(i)}}if(d!=-1){new Wikifier(macroName=="nobr"?place:h,c);parser.nextMatch=d}else{throwError(place,"can't find matching end"+macroName,parser.fullMatch())}}};macros.endsilently={handler:function(){}};version.extensions.choiceMacro={major:2,minor:0,revision:0};macros.choice={callback:function(){var i,other,passage=findPassageParent(this);if(passage){other=passage.querySelectorAll(".choice");for(i=0;i<other.length;i++){other[i].outerHTML="<span class=disabled>"+other[i].innerHTML+"</span>"}state.history[0].variables["choice clicked"][passage.id.replace(/\|[^\]]*$/,"")]=true}},handler:function(A,C,D,parser){var link,id,match,text=D[1]||D[0].split("|")[0],passage=findPassageParent(A);if(!passage){throwError(A,"<<"+C+">> can't be used here.",parser.fullMatch());return}id=(passage&&passage.id.replace(/\|[^\]]*$/,""));if(id&&(state.history[0].variables["choice clicked"]||(state.history[0].variables["choice clicked"]={}))[id]){insertElement(A,"span",null,"disabled",text)}else{match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullArgs());if(match){link=Wikifier.linkFormatter.makeLink(A,match,this.callback)}else{link=Wikifier.linkFormatter.makeLink(A,[0,text,D[0]],this.callback)}link.className+=" "+C}}};version.extensions.backMacro={major:2,minor:0,revision:0};macros.back={labeltext:"&#171; back",handler:function(a,b,e,parser){var labelParam,c,el,labeltouse=this.labeltext,steps=1,stepsParam=e.indexOf("steps"),stepsParam2="";if(stepsParam>0){stepsParam2=e[stepsParam-1];if(stepsParam2[0]=="$"){try{stepsParam2=eval(Wikifier.parse(stepsParam2))}catch(r){throwError(a,"<<"+b+">> bad expression: "+r.message,parser.fullMatch());return}}steps=+stepsParam2;if(steps>=state.history.length-1){steps=state.history.length-2}e.splice(stepsParam-1,2)}labelParam=e.indexOf("label");if(labelParam>-1){if(!e[labelParam+1]){throwError(a,e[labelParam]+" keyword needs an additional label parameter",parser.fullMatch());return}labeltouse=e[labelParam+1];if(e[labelParam]=="labeldefault"){this.labeltext=labeltouse}e.splice(labelParam,2)}if(stepsParam<=0){if(e[0]){if(e[0].charAt(0)=="$"){try{e=eval(Wikifier.parse(e[0]))}catch(r){throwError(a,"<<"+b+">> bad expression: "+r.message,parser.fullMatch());return}}else{e=e[0]}if(!tale.has(e)){throwError(a,'The "'+e+'" passage does not exist',parser.fullMatch());return}for(c=0;c<state.history.length;c++){if(state.history[c].passage.title==e){steps=c;break}}}}el=document.createElement("a");el.className=b;el.onclick=(function(b){return function(){return macros.back.onclick(b=="back",steps,el)}}(b));el.innerHTML=labeltouse;a.appendChild(el)}};version.extensions.returnMacro={major:2,minor:0,revision:0};macros["return"]={labeltext:"&#171; return",handler:function(a,b,e){macros.back.handler.call(this,a,b,e)}};version.extensions.textInputMacro={major:2,minor:0,revision:0};macros.checkbox=macros.radio=macros.textinput={handler:function(A,C,D,parser){var match,class_=C.replace("input","Input"),q=A.querySelectorAll("input"),id=class_+"|"+((q&&q.length)||0);input=insertElement(null,"input",id,class_);input.name=D[0];input.type=C.replace("input","");A.appendChild(input);if(C=="textinput"&&D[1]){match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullArgs());if(match){Wikifier.linkFormatter.makeLink(A,match,macros.button.callback,"button")}else{Wikifier.linkFormatter.makeLink(A,[0,(D[2]||D[1]),D[1]],macros.button.callback,"button")}}else{if((C=="radio"||C=="checkbox")&&D[1]){input.value=D[1];insertElement(A,"label","","",D[1]).setAttribute("for",id);if(D[2]){insertElement(A,"br");D.splice(1,1);macros[C].handler(A,C,D)}}}}};version.extensions.buttonMacro={major:1,minor:0,revision:0};macros.button={callback:function(){var el=findPassageParent(this);if(el){var inputs=el.querySelectorAll("input");for(i=0;i<inputs.length;i++){if(inputs[i].type!="checkbox"&&(inputs[i].type!="radio"||inputs[i].checked)){macros.set.run(null,Wikifier.parse(inputs[i].name+' = "'+inputs[i].value.replace(/"/g,'\\"')+'"'))}else{if(inputs[i].type=="checkbox"&&inputs[i].checked){macros.set.run(null,Wikifier.parse(inputs[i].name+" = [].concat("+inputs[i].name+" || []);"));macros.set.run(null,Wikifier.parse(inputs[i].name+'.push("'+inputs[i].value.replace(/"/g,'\\"')+'")'))}}}}},handler:function(A,C,D,parser){var link,match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullArgs());if(match){Wikifier.linkFormatter.makeLink(A,match,this.callback,"button")}else{Wikifier.linkFormatter.makeLink(A,[0,D[1]||D[0],D[0]],this.callback,"button")}}};function Passage(c,b,a,ofunc,okey){var t,k;this.title=c;if(b){this.id=a;if(ofunc!=null&&typeof ofunc=="function"&&okey!=null){t=b.firstChild?b.firstChild.nodeValue:"";this.initialText=this.text=ofunc(Passage.unescapeLineBreaks(t),okey);this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){this.tags=ofunc(this.tags,okey);this.tags=this.tags.readBracketedList()}else{this.tags=[]}}else{this.initialText=this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:"");this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){this.tags=this.tags.readBracketedList()}else{this.tags=[]}}if(!~(this.tags.indexOf("Twine.image"))){this.preloadImages()}}else{this.initialText=this.text="@@This passage does not exist: "+c+"@@";this.tags=[]}}Passage.prototype.preloadImages=function(){var u="s*['\"]?([^\"']+.(jpe?g|a?png|gif|bmp|webp|svg))['\"]?s*",k=function(c,e){var i,d;do{d=c.exec(this.initialText);if(d){i=new Image();i.src=d[e]}}while(d);return k};k.call(this,new RegExp(Wikifier.imageFormatter.lookahead.replace("[^\\[\\]\\|]+",u),"mg"),4).call(this,new RegExp("url("+u+")","mig"),1).call(this,new RegExp("srcs*="+u,"mig"),1)};Passage.unescapeLineBreaks=function(a){if(a&&typeof a=="string"){return a.replace(/\\n/mg,"\n").replace(/\\t/mg,"\t").replace(/\\s/mg,"\\").replace(/\\/mg,"\\").replace(/\r/mg,"")}else{return""}};Passage.prototype.setTags=function(b){var t=this.tags!=null&&this.tags.length?this.tags.join(" "):"";if(t){b.setAttribute("data-tags",this.tags.join(" "))}document.body.setAttribute("data-tags",t)};Passage.prototype.processText=function(){var ret=this.text;if(~this.tags.indexOf("nobr")){ret=ret.replace(/\n/g,"\u200c")}if(~this.tags.indexOf("Twine.image")){ret="[img["+ret+"]]"}return ret};function Tale(){var a,b,c,lines,i,kv,ns,nsc,nope,settings=this.storysettings={lookup:function(a){return !~["0","off","false"].indexOf((this[a]+""))}},tiddlerTitle="";function deswap(t,k){var i,c,p,p1,up,r="";for(i=0;i<t.length;i++){c=t.charAt(i);up=(c==c.toUpperCase());p=k.indexOf(c.toLowerCase());if(p>-1){p1=p+(p%2==0?1:-1);if(p1>=k.length){p1=p}c=k.charAt(p1);up&&(c=c.toUpperCase())}r=r+c}return r}this.passages={};if(document.normalize){document.normalize()}a=document.getElementById("storeArea").children;for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&c.getAttribute("tiddler")=="StorySettings"){lines=new Passage("StorySettings",c,0,null,null).text.split("\n");for(i in lines){if(typeof lines[i]=="string"&&lines[i].indexOf(":")>-1){kv=lines[i].toLowerCase().split(":");kv[0]=kv[0].replace(/^\s+|\s+$/g,"");kv[1]=kv[1].replace(/^\s+|\s+$/g,"");if(kv[0]!="lookup"){settings[kv[0]]=kv[1]}}}}}if(settings.obfuscate=="swap"&&settings.obfuscatekey){ns="";nope=':\\"n0';if(settings.obfuscatekey=="rot13"){settings.obfuscatekey="anbocpdqerfsgthuivjwkxlymz"}for(i=0;i<settings.obfuscatekey.length;i++){nsc=settings.obfuscatekey[i];if(ns.indexOf(nsc)==-1&&nope.indexOf(nsc)==-1){ns=ns+nsc}}settings.obfuscatekey=ns;for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){if(tiddlerTitle!="StorySettings"){tiddlerTitle=deswap(tiddlerTitle,settings.obfuscatekey)}this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b+1,deswap,settings.obfuscatekey)}}}else{for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b,null,null)}}}}Tale.prototype.has=function(a){if(typeof a=="string"){return(this.passages[a]!=null)}else{for(var i in this.passages){if(this.passages[i].id==a){return true}}return false}};Tale.prototype.get=function(a){if(typeof a=="string"){return this.passages[a]||new Passage(a)}else{for(var i in this.passages){if(this.passages[i].id==a){return this.passages[i]}}}};Tale.prototype.lookup=function(h,g,a){var d=[];for(var c in this.passages){var f=this.passages[c];for(var b=0;b<f[h].length;b++){if(f[h][b]==g){d.push(f)}}}if(!a){a="title"}d.sort(function(k,j){if(k[a]==j[a]){return(0)}else{return(k[a]<j[a])?-1:+1}});return d};Tale.prototype.canUndo=function(){return this.storysettings.lookup("undo")};Tale.prototype.forEachStylesheet=function(tags,callback){var passage,i;tags=tags||[];if(typeof callback!="function"){return}for(passage in this.passages){passage=tale.passages[passage];if(passage&&~passage.tags.indexOf("stylesheet")){for(i=0;i<tags.length;i++){if(~passage.tags.indexOf(tags[i])){callback(passage);break}}}}};Tale.prototype.setPageElements=function(){var storyTitle,defaultTitle="sundown";setPageElement("storyTitle","StoryTitle",defaultTitle);storyTitle=document.getElementById("storyTitle");document.title=this.title=(storyTitle&&(storyTitle.textContent||storyTitle.innerText))||defaultTitle;setPageElement("storySubtitle","StorySubtitle","");if(tale.has("StoryAuthor")){setPageElement("titleSeparator",null,"\n");setPageElement("storyAuthor","StoryAuthor","")}if(tale.has("StoryMenu")){document.getElementById("storyMenu").style.display="block";setPageElement("storyMenu","StoryMenu","")}};function Wikifier(place,source){this.source=source;this.output=place;this.nextMatch=0;this.assembleFormatterMatches(Wikifier.formatters);this.subWikify(this.output)}Wikifier.prototype.assembleFormatterMatches=function(formatters){this.formatters=[];var pattern=[];for(var n=0;n<formatters.length;n++){pattern.push("("+formatters[n].match+")");this.formatters.push(formatters[n])}this.formatterRegExp=new RegExp(pattern.join("|"),"mg")};Wikifier.prototype.subWikify=function(output,terminator){var terminatorMatch,formatterMatch,oldOutput=this.output;this.output=output;var terminatorRegExp=terminator?new RegExp("("+terminator+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch;if(terminatorRegExp){terminatorRegExp.lastIndex=this.nextMatch}formatterMatch=this.formatterRegExp.exec(this.source);terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null;if(terminatorMatch&&(!formatterMatch||terminatorMatch.index<=formatterMatch.index)){if(terminatorMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,terminatorMatch.index)}this.matchStart=terminatorMatch.index;this.matchLength=terminatorMatch[1].length;this.matchText=terminatorMatch[1];this.nextMatch=terminatorMatch.index+terminatorMatch[1].length;this.output=oldOutput;return}else{if(formatterMatch){if(formatterMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,formatterMatch.index)}this.matchStart=formatterMatch.index;this.matchLength=formatterMatch[0].length;this.matchText=formatterMatch[0];this.nextMatch=this.formatterRegExp.lastIndex;var matchingFormatter=-1;for(var t=1;t<formatterMatch.length;t++){if(formatterMatch[t]){matchingFormatter=t-1;break}}if(matchingFormatter!=-1){this.formatters[matchingFormatter].handler(this)}}}}while(terminatorMatch||formatterMatch);if(this.nextMatch<this.source.length){this.outputText(this.output,this.nextMatch,this.source.length);this.nextMatch=this.source.length}this.output=oldOutput};Wikifier.prototype.outputText=function(place,startPos,endPos){insertText(place,this.source.substring(startPos,endPos))};Wikifier.prototype.fullMatch=function(){return this.source.slice(this.matchStart,this.source.indexOf(">>",this.matchStart)+2)};Wikifier.prototype.fullArgs=function(includeName){var source=this.source.replace(/\u200c/g," "),endPos=source.indexOf(">>",this.matchStart),startPos=source.indexOf(includeName?"<<":" ",this.matchStart);if(!~startPos||!~endPos||endPos<=startPos){return""}return Wikifier.parse(source.slice(startPos+(includeName?2:1),endPos).trim())};Wikifier.parse=function(input){var m,re,b=input,found=[],g="(?=(?:[^\"'\\\\]*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"))*[^'\"]*$)";function alter(from,to){return b.replace(new RegExp(from+g,"gi"),to)}re=new RegExp(Wikifier.textPrimitives.variable,"gi");while(m=re.exec(input)){if(!~found.indexOf(m[0])){b=m[0]+" == null && ("+m[0]+" = 0);"+b;found.push(m[0])}}b=alter(Wikifier.textPrimitives.variable,"state.history[0].variables.$1");b=alter("\\beq\\b"," == ");b=alter("\\bneq\\b"," != ");b=alter("\\bgt\\b"," > ");b=alter("\\bgte\\b"," >= ");b=alter("\\blt\\b"," < ");b=alter("\\blte\\b"," <= ");b=alter("\\band\\b"," && ");b=alter("\\bor\\b"," || ");b=alter("\\bnot\\b"," ! ");b=alter("\\bis\\b"," == ");b=alter("\\bto\\b"," = ");return b};Wikifier.formatHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(w){var s,v,lookaheadMatch,gotMatch,styles=[],lookahead="(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)",lookaheadRegExp=new RegExp(lookahead,"mg"),hadStyle=false;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source);gotMatch=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(gotMatch){hadStyle=true;if(lookaheadMatch[1]){s=lookaheadMatch[1].unDash();v=lookaheadMatch[2]}else{s=lookaheadMatch[3].unDash();v=lookaheadMatch[4]}switch(s){case"bgcolor":s="backgroundColor";break;case"float":s="cssFloat";break}styles.push({style:s,value:v});w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}while(gotMatch);return styles},monospacedByLineHelper:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var text=lookaheadMatch[1];if(navigator.userAgent.indexOf("msie")!=-1&&navigator.userAgent.indexOf("opera")==-1){text=text.replace(/\n/g,"\r")}var e=insertElement(w.output,"pre",null,null,text);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{"c":"caption","h":"thead","":"tbody","f":"tfoot"},handler:function(w){var rowContainer,rowElement,lookaheadMatch,matched,table=insertElement(w.output,"table"),lookaheadRegExp=new RegExp(this.lookahead,"mg"),currRowType=null,nextRowType,prevColumns=[],rowCount=0;w.nextMatch=w.matchStart;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source),matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){nextRowType=lookaheadMatch[2];if(nextRowType!=currRowType){rowContainer=insertElement(table,this.rowTypes[nextRowType])}currRowType=nextRowType;if(currRowType=="c"){if(rowCount==0){rowContainer.setAttribute("align","top")}else{rowContainer.setAttribute("align","bottom")}w.nextMatch=w.nextMatch+1;w.subWikify(rowContainer,this.rowTerminator)}else{rowElement=insertElement(rowContainer,"tr");this.rowHandler(w,rowElement,prevColumns)}rowCount++}}while(matched)},rowHandler:function(w,e,prevColumns){var cellMatch,matched,col=0,currColCount=1,cellRegExp=new RegExp(this.cellPattern,"mg");do{cellRegExp.lastIndex=w.nextMatch;cellMatch=cellRegExp.exec(w.source);matched=cellMatch&&cellMatch.index==w.nextMatch;if(matched){if(cellMatch[1]=="~"){var last=prevColumns[col];if(last){last.rowCount++;last.element.setAttribute("rowSpan",last.rowCount);last.element.setAttribute("rowspan",last.rowCount);last.element.valign="center"}w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[1]==">"){currColCount++;w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}else{var spaceLeft=false,spaceRight=false,lastColCount,lastColElement,styles,cell,t;w.nextMatch++;styles=Wikifier.formatHelpers.inlineCssHelper(w);while(w.source.substr(w.nextMatch,1)==" "){spaceLeft=true;w.nextMatch++}if(w.source.substr(w.nextMatch,1)=="!"){cell=insertElement(e,"th");w.nextMatch++}else{cell=insertElement(e,"td")}prevColumns[col]={rowCount:1,element:cell};lastColCount=1;lastColElement=cell;if(currColCount>1){cell.setAttribute("colSpan",currColCount);cell.setAttribute("colspan",currColCount);currColCount=1}for(t=0;t<styles.length;t++){cell.style[styles[t].style]=styles[t].value}w.subWikify(cell,this.cellTerminator);if(w.matchText.substr(w.matchText.length-2,1)==" "){spaceRight=true}if(spaceLeft&&spaceRight){cell.align="center"}else{if(spaceLeft){cell.align="right"}else{if(spaceRight){cell.align="left"}}}w.nextMatch=w.nextMatch-1}}}col++}}while(matched)}},{name:"rule",match:"^----$\\n?",handler:function(w){insertElement(w.output,"hr")}},{name:"emdash",match:"--",handler:function(a){insertElement(a.output,"span",null,"char "+String.fromCharCode(8212),String.fromCharCode(8212))}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(w){var e=insertElement(w.output,"h"+w.matchLength);w.subWikify(e,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(w){w.subWikify(w.output,this.terminator)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){var e=insertElement(w.output,"blockquote");w.subWikify(e,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(w){var lookaheadRegExp=new RegExp(this.match,"mg");var placeStack=[w.output];var currLevel=0;var newLevel=w.matchLength;var t;do{if(newLevel>currLevel){for(t=currLevel;t<newLevel;t++){placeStack.push(insertElement(placeStack[placeStack.length-1],this.element))}}else{if(newLevel<currLevel){for(t=currLevel;t>newLevel;t--){placeStack.pop()}}}currLevel=newLevel;w.subWikify(placeStack[placeStack.length-1],this.terminator);lookaheadRegExp.lastIndex=w.nextMatch;var lookaheadMatch=lookaheadRegExp.exec(w.source);var matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){newLevel=lookaheadMatch[0].length;w.nextMatch+=lookaheadMatch[0].length;insertElement(placeStack[placeStack.length-1],"br")}}while(matched)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");w.nextMatch=w.matchStart;var placeStack=[w.output];var currType=null,newType;var currLevel=0,newLevel;var t;do{lookaheadRegExp.lastIndex=w.nextMatch;var lookaheadMatch=lookaheadRegExp.exec(w.source);var matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){if(lookaheadMatch[1]){newType="ul"}if(lookaheadMatch[2]){newType="ol"}newLevel=lookaheadMatch[0].length;w.nextMatch+=lookaheadMatch[0].length;if(newLevel>currLevel){for(t=currLevel;t<newLevel;t++){placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}else{if(newLevel<currLevel){for(t=currLevel;t>newLevel;t--){placeStack.pop()}}else{if(newLevel==currLevel&&newType!=currType){placeStack.pop();placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}}currLevel=newLevel;currType=newType;var e=insertElement(placeStack[placeStack.length-1],"li");w.subWikify(e,this.terminator)}}while(matched)}},(Wikifier.urlFormatter={name:"urlLink",match:"(?:http|https|mailto|javascript|ftp|data):[^\\s'\"]+(?:/|\\b)",handler:function(w){var e=Wikifier.createExternalLink(w.output,w.matchText);w.outputText(e,w.matchStart,w.nextMatch)}}),(Wikifier.linkFormatter={name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:\\|(.*?))?\\](?:\\[(.*?)])?\\]",makeInternalOrExternal:function(out,title,callback,type){if(title&&!tale.has(title)&&(title.match(Wikifier.urlFormatter.match,"g")||~title.search(/[\.\\\/#]/))){return Wikifier.createExternalLink(out,title,callback,type)}else{return Wikifier.createInternalLink(out,title,callback,type)}},makeCallback:function(out,code,callback){return function(){macros.set.run(out,Wikifier.parse(code));typeof callback=="function"&&callback.call(this)}},makeLink:function(out,match,callback2,type){var link,title,callback;if(match[3]){callback=this.makeCallback(out,match[3],callback2)}else{typeof callback2=="function"&&(callback=callback2)}title=Wikifier.parsePassageTitle(match[2]||match[1]);link=this.makeInternalOrExternal(out,title,callback,type);setPageElement(link,null,match[2]?match[1]:title);return link},handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){this.makeLink(w.output,lookaheadMatch);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),(Wikifier.imageFormatter={name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]?)(>?)img\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mig");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=w.output,title=Wikifier.parsePassageTitle(lookaheadMatch[5]);if(title){e=Wikifier.linkFormatter.makeInternalOrExternal(w.output,title)}var img=insertElement(e,"img");if(lookaheadMatch[1]){img.align="left"}else{if(lookaheadMatch[2]){img.align="right"}}if(lookaheadMatch[3]){img.title=lookaheadMatch[3]}img.src=lookaheadMatch[4];var imgPassages=tale.lookup("tags","Twine.image");for(var j=0;j<imgPassages.length;j++){if(imgPassages[j].title==lookaheadMatch[4]){img.src=imgPassages[j].text;break}}w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)((?:[^>]|>(?!>))*)>>",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source.replace(/\u200c/g,"\n"));if(lookaheadMatch&&lookaheadMatch.index==w.matchStart&&lookaheadMatch[1]){var params=lookaheadMatch[2].readMacroParams();w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length;var name=lookaheadMatch[1];try{var macro=macros[name];if(macro&&macro.handler){macro.handler(w.output,name,params,w)}else{if(name[0]=="$"){macros.print.handler(w.output,name,[name].concat(params),w)}else{if(tale.has(name)){macros.display.handler(w.output,name,[name].concat(params),w)}else{throwError(w.output,"Macro not found: "+name,w.fullMatch())}}}}catch(e){throwError(w.output,"Error executing macro "+name+": "+e.toString(),w.fullMatch())}}}},{name:"html",match:"<html>",lookahead:"<html>((?:.|\\n)*?)</html>",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"span");e.innerHTML=lookaheadMatch[1];w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"code",null,null,lookaheadMatch[1]);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(w){var e=insertElement(w.output,"span",null,null,null);var styles=Wikifier.formatHelpers.inlineCssHelper(w);if(styles.length==0){e.className="marked"}else{for(var t=0;t<styles.length;t++){e.style[styles[t].style]=styles[t].value}}w.subWikify(e,this.terminator)}},{name:"lineBreak",match:"\\n",handler:function(w){insertElement(w.output,"br")}},{name:"continuedLine",match:"\\\\\\s*?\\n",handler:function(a){a.nextMatch=a.matchStart+2}},{name:"htmltag",match:"<\\w+(?:(?:\\s+\\w+(?:\\s*=\\s*(?:\".*?\"|'.*?'|[^'\">\\s]+))?)+\\s*|\\s*)\\/?>",tagname:"<(\\w+)",voids:["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],tableElems:["table","thead","tbody","tfoot","th","tr","td","colgroup","col","caption","figcaption"],cleanupTables:function(e){var i,name,elems=[].slice.call(e.children);for(i=0;i<elems.length;i++){if(elems[i].tagName){name=elems[i].tagName.toLowerCase();if(this.tableElems.indexOf(name)==-1){elems[i].outerHTML=""}else{if(["col","caption","figcaption","td","th"].indexOf(name)==-1){this.cleanupTables.call(this,elems[i])}}}}},handler:function(a){var e,isvoid,lookaheadRegExp,lookaheadMatch,lookahead,re=new RegExp(this.tagname).exec(a.matchText),tn=re&&re[1];if(tn&&tn.toLowerCase()!="html"){lookahead="<\\/\\s*"+tn+"\\s*>";isvoid=(this.voids.indexOf(tn.toLowerCase())!=-1);lookaheadRegExp=new RegExp(lookahead,"mg");lookaheadRegExp.lastIndex=a.matchStart;lookaheadMatch=lookaheadRegExp.exec(a.source);if(lookaheadMatch||isvoid){e=document.createElement(a.output.tagName);e.innerHTML=a.matchText;while(e.firstChild){e=e.firstChild}if(!isvoid){a.subWikify(e,lookahead)}if(e.tagName.toLowerCase()=="table"){this.cleanupTables.call(this,e)}a.output.appendChild(e)}else{throwError(a.output,"HTML tag '"+tn+"' wasn't closed.",a.matchText)}}}},{name:"char",match:".",handler:function(a){insertElement(a.output,"span",null,"char "+(a.matchText==" "?"space":a.matchText=="\t"?"tab":a.matchText),a.matchText)}}];Wikifier.parsePassageTitle=function(title){if(title&&!tale.has(title)){try{title=(eval(this.parse(title))||title)+""}catch(e){}}return title};Wikifier.linkFunction=function(title,el,callback){return function(){if(state.rewindTo){var passage=findPassageParent(el);if(passage&&passage.parentNode.lastChild!=passage){state.rewindTo(passage,true)}}state.display(title,el,null,callback)}};Wikifier.createInternalLink=function(place,title,callback,type){var tag=(type=="button"?"button":"a"),suffix=(type=="button"?"Button":"Link"),el=insertElement(place,tag,title);if(tale.has(title)){el.className="internal"+suffix;if(visited(title)){el.className+=" visited"+suffix}}else{el.className="broken"+suffix}el.onclick=Wikifier.linkFunction(title,el,callback);if(place){place.appendChild(el)}return el};Wikifier.createExternalLink=function(place,url,callback,type){var tag=(type=="button"?"button":"a"),el=insertElement(place,tag);el.href=url;el.className="external"+(type=="button"?"Button":"Link");el.target="_blank";if(typeof callback=="function"){el.onclick=callback}if(place){place.appendChild(el)}return el};if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))){Wikifier.textPrimitives={upperLetter:"[A-Z\u00c0-\u00de]",lowerLetter:"[a-z\u00df-\u00ff_0-9\\-]",anyLetter:"[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]"}}else{Wikifier.textPrimitives={upperLetter:"[A-Z\u00c0-\u00de\u0150\u0170]",lowerLetter:"[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]",anyLetter:"[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"}}Wikifier.textPrimitives.variable="\\$((?:"+Wikifier.textPrimitives.anyLetter.replace("\\-","\\.")+"*"+Wikifier.textPrimitives.anyLetter.replace("0-9\\-","\\.")+"+"+Wikifier.textPrimitives.anyLetter.replace("\\-","\\.")+"*)+)";function visited(e){var ret=0,i=0;if(!state){return 0}e=e||state.history[0].passage.title;if(arguments.length>1){for(ret=state.history.length;i<arguments.length;i++){ret=Math.min(ret,visited(arguments[i]))}}else{for(;i<state.history.length&&state.history[i].passage;i++){if(e==state.history[i].passage.title){ret++}}}return ret}function visitedTag(){var i,j,k,ret=0;if(!state){return 0}for(i=0;i<state.history.length&&state.history[i].passage;i++){for(j=0;j<state.history.length&&state.history[i].passage;i++){for(k=0;k<arguments.length||void ret++;k++){if(state.history[i].passage.tags.indexOf(arguments[k])==-1){break}}}}return ret}function turns(){return state.history.length-1}function passage(){return state.history[0].passage.title}function tags(e){var ret=[],i=0;if(!state){return 0}e=e||state.history[0].passage.title;if(arguments.length>1){for(i=arguments.length-1;i>=1;i--){ret=ret.concat(tags(arguments[i]))}}ret=ret.concat(tale.get(e).tags);return ret}function previous(){if(state&&state.history[1]){for(var d=1;d<state.history.length&&state.history[d].passage;d++){if(state.history[d].passage.title!=state.history[0].passage.title){return state.history[d].passage.title}}}return""}function either(){return arguments[~~(Math.random()*arguments.length)]}function parameter(n){n=n||0;if(macros.display.parameters[n]){return macros.display.parameters[n]}return 0}function scriptEval(s){try{eval(s.text)}catch(e){alert("There is a technical problem with this story ("+s.title+": "+e.message+")."+softErrorMessage)}}var softErrorMessage=" You may be able to continue playing, but parts of the story may not work properly.";window.onerror=function(e){alert("Sorry to interrupt, but this story's code has got itself in a mess ("+e+")."+softErrorMessage);window.onerror=null};var $;function main(){$=window.$||function(a){return(typeof a=="string"?document.getElementById(a):a)};var imgs,scripts,macro,style,styleText="",i,passages=document.getElementById("passages");function sanityCheck(thing){if(!sanityCheck.display){if(History.prototype.display.length<4&&!~History.prototype.display.toString().indexOf("arguments")){alert("NOTE: The "+thing+" contains a function that patches History.prototype.display, but takes the wrong number of arguments."+softErrorMessage)}sanityCheck.display=true}}if(!window.JSON||!document.querySelector){return(passages.innerHTML="This story requires a newer web browser. Sorry.")}else{passages.innerHTML=""}tale=window.tale=new Tale();if(~document.documentElement.className.indexOf("lt-ie9")){imgs=tale.lookup("tags","Twine.image");for(i=0;i<imgs.length;i++){if(imgs[i].text.length>=32768){alert("NOTE: This story's HTML file contains embedded images that may be too large for this browser to display."+softErrorMessage);break}}}scripts=tale.lookup("tags","script");for(i=0;i<scripts.length;i++){scriptEval(scripts[i]);sanityCheck('script passage "'+scripts[i].title+'"')}state=window.state=new History();for(i in macros){macro=macros[i];if(typeof macro.init=="function"){macro.init();sanityCheck('init() of the custom macro "'+i+'"')}}style=document.getElementById("storyCSS");for(i in tale.passages){i=tale.passages[i];if(i.tags+""=="stylesheet"){styleText+=alterCSS(i.text)}else{if(i.tags.length==2&&i.tags.indexOf("transition")>-1&&i.tags.indexOf("stylesheet")>-1){setTransitionCSS(i.text)}}}style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText);state.init()};

var hasPushState=!!window.history&&(typeof window.history.pushState=="function");Tale.prototype.canBookmark=function(){return this.canUndo()&&(this.storysettings.lookup("bookmark")||!hasPushState)};History.prototype.init=function(){var a=this;if(!this.restore()){this.display("Start",null)}if(!hasPushState){this.hash=window.location.hash;this.interval=window.setInterval(function(){a.watchHash()},250)}};hasPushState&&(History.prototype.pushState=function(replace,uri){window.history[replace?"replaceState":"pushState"]({id:this.id,length:this.history.length},document.title,uri)});History.prototype.display=function(title,source,type,callback){var e,bookmarkhref,c=tale.get(title),p=document.getElementById("passages");if(c==null){return}if(type!="back"){this.saveVariables(c,source,callback);if(hasPushState&&tale.canUndo()){try{sessionStorage.setItem("history"+this.id,JSON.stringify(this.history));this.pushState(this.history.length<=2&&window.history.state=="")}catch(e){alert("Your browser couldn't save the state of the game.\n"+"You may continue playing, but it will no longer be possible to undo moves from here on in.");tale.storysettings.undo="off"}}}bookmarkhref=this.save();e=c.render();if(type!="quietly"){if(hasTransition){for(var i=0;i<p.childNodes.length;i+=1){var q=p.childNodes[i];q.classList.add("transition-out");setTimeout((function(a){return function(){if(a.parentNode){a.parentNode.removeChild(a)}}}(q)),1000)}e.classList.add("transition-in");setTimeout(function(){e.classList.remove("transition-in")},1);e.style.visibility="visible";p.appendChild(e)}else{removeChildren(p);p.appendChild(e);fade(e,{fade:"in"})}tale.setPageElements()}else{p.appendChild(e);e.style.visibility="visible"}if(tale.canUndo()){if(!hasPushState&&type!="back"){this.hash=bookmarkhref;window.location.hash=this.hash}else{if(tale.canBookmark()){var bookmark=document.getElementById("bookmark");bookmark&&(bookmark.href=bookmarkhref)}}}window.scroll(0,0);return e};History.prototype.watchHash=function(){if(window.location.hash!=this.hash){if(window.location.hash&&(window.location.hash!="#")){this.history=[{passage:null,variables:{}}];removeChildren(document.getElementById("passages"));if(!this.restore()){alert("The passage you had previously visited could not be found.")}}else{window.location.reload()}this.hash=window.location.hash}};History.prototype.loadLinkVars=function(){for(var c in this.history[0].linkVars){this.history[0].variables[c]=clone(this.history[0].linkVars[c])}};Passage.prototype.render=function(){var b=insertElement(null,"div","passage"+this.title,"passage");b.style.visibility="hidden";this.setTags(b);this.setCSS();insertElement(b,"div","","header");var a=insertElement(b,"div","","body content");for(var i in prerender){(typeof prerender[i]=="function")&&prerender[i].call(this,a)}new Wikifier(a,this.processText());insertElement(b,"div","","footer");for(i in postrender){(typeof postrender[i]=="function")&&postrender[i].call(this,a)}return b};Passage.prototype.excerpt=function(){var b=this.text.replace(/<<.*?>>/g,"");b=b.replace(/!.*?\n/g,"");b=b.replace(/[\[\]\/]/g,"");var a=b.split("\n");while(a.length&&a[0].length==0){a.shift()}var c="";if(a.length==0||a[0].length==0){c=this.title}else{c=a[0].substr(0,30)+"..."}return c};Passage.transitionCache="";Passage.prototype.setCSS=function(){var trans=false,text="",tags=this.tags||[],c=document.getElementById("tagCSS"),c2=document.getElementById("transitionCSS");if(c&&c.getAttribute("data-tags")!=tags.join(" ")){tale.forEachStylesheet(tags,function(passage){if(~passage.tags.indexOf("transition")){if(!Passage.transitionCache&&c2){Passage.transitionCache=c2.innerHTML}setTransitionCSS(passage.text);trans=true}else{text+=alterCSS(passage.text)}});if(!trans&&Passage.transitionCache&&c2){setTransitionCSS(Passage.transitionCache);trans=false;Passage.transitionCache=""}c.styleSheet?(c.styleSheet.cssText=text):(c.innerHTML=text);c.setAttribute("data-tags",tags.join(" "))}};var Interface={init:function(){var snapback=document.getElementById("snapback"),restart=document.getElementById("restart"),bookmark=document.getElementById("bookmark");main();if(snapback){if(!tale.lookup("tags","bookmark").length){snapback.parentNode.removeChild(snapback)}else{snapback.onclick=Interface.showSnapback}}if(bookmark&&(!tale.canBookmark()||!hasPushState)){bookmark.parentNode.removeChild(bookmark)}restart&&(restart.onclick=Interface.restart)},restart:function(){if(confirm("Are you sure you want to restart this story?")){state.restart()}},showSnapback:function(a){Interface.hideAllMenus();Interface.buildSnapback();Interface.showMenu(a,document.getElementById("snapbackMenu"))},buildSnapback:function(){var b,c=false,menuelem=document.getElementById("snapbackMenu");while(menuelem.hasChildNodes()){menuelem.removeChild(menuelem.firstChild)}for(var a=state.history.length-1;a>=0;a--){if(state.history[a].passage&&state.history[a].passage.tags.indexOf("bookmark")!=-1){b=document.createElement("div");b.pos=a;b.onclick=function(){var p=this.pos;var n=state.history[p].passage.title;while(p>=0){if(state.history.length>1){state.history.shift()}p--}state.display(n)};b.innerHTML=state.history[a].passage.excerpt();menuelem.appendChild(b);c=true}}if(!c){b=document.createElement("div");b.innerHTML="<i>No passages available</i>";document.getElementById("snapbackMenu").appendChild(b)}},hideAllMenus:function(){document.getElementById("snapbackMenu").style.display="none"},showMenu:function(b,a){if(!b){b=window.event}var c={x:0,y:0};if(b.pageX||b.pageY){c.x=b.pageX;c.y=b.pageY}else{if(b.clientX||b.clientY){c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}a.style.top=c.y+"px";a.style.left=c.x+"px";a.style.display="block";document.onclick=Interface.hideAllMenus;b.cancelBubble=true;if(b.stopPropagation){b.stopPropagation()}}};window.onload=Interface.init;macros.back.onclick=function(back,steps){var title;if(back){if(tale.canUndo()){window.history.go(-steps);return}while(steps-->=0&&state.history.length>1){title=state.history[0].passage.title;state.history.shift()}state.loadLinkVars();state.saveVariables(tale.get(title));state.display(title,null,"back")}else{state.display(state.history[steps].passage.title)}};window.onpopstate=function(e){var title,hist,steps,s=e&&e.state;if(s&&s.id&&s.length!=null){hist=JSON.parse(sessionStorage.getItem("history"+s.id)),steps=hist.length-s.length}if(hist!=null&&steps!=null){state.history=hist;while(steps-->=0&&state.history.length>1){title=state.history[0].passage.title;state.history.shift()}state.loadLinkVars();state.saveVariables(tale.get(title));state.display(title,null,"back")}};

testplay = "";

}());
</script>
<script title="modules">


</script>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style id="baseCSS">
@font-face {
  font-family: 'Press Start 2P';
  src: url(PressStart2P-Regular.ttf);
}
body {
	background-color: #000;
	color: #fff;
	font-family: 'Press Start 2P',Verdana,sans-serif;
	font-size: 62.5%;
	margin: 4em 15% 5% 5em;
}
#sidebar {
	position: absolute;
	width: 12em;
	left: 7.5em;
	list-style: none;
	margin: 0;
	padding: 0 1em 0 0;
	font: bold 1.1em Verdana,sans-serif;
}
#sidebar li {
	color: #333;
	text-align: right;
	background-repeat: no-repeat;
	margin-bottom: 1em;
	line-height: 1.4em !important;
	list-style: none;
}
#sidebar li:hover {
	color: #fff;
	cursor: pointer;
}
#sidebar li a {
	color: #333;
	text-decoration: none;
}
#sidebar li a:hover, #sidebar #title a:hover {
	color: #fff;
	text-decoration: none;
}
#sidebar #title {
	color: #999;
	font-size: 150%;
	cursor: auto;
}
#sidebar #title a {
	color: #999;
}
#sidebar #storySubtitle {
	font-size: 75%;
	display: block;
}
#storyAuthor {
	font-size: 50%;
}
#sidebar #storyMenu {
	display: none;
	line-height: 2.5em;
	margin-bottom: .5em;
	color: #999;
	cursor: auto;
	text-align:right !important;
}
#sidebar #title:hover {
	color: #999;
}
#sidebar #credits {
	padding-top: 2em;
	font-weight: normal;
	font-size: 80%;
	cursor: auto;
}
#sidebar #credits:hover {
	color: #333;
}
#sidebar #credits a {
	text-decoration: none;
}
.menu {
	position: absolute;
	display: none;
	background-color: #343434;
	color: #fff;
	opacity: .9;
	border: 1px solid #fff;
	text-align: left;
	font: 1.1em Verdana;
	line-height: 2em;
}
.menu div {
	padding: 0 .4em;
}
.menu div:hover {
	cursor: pointer;
	background-color: #fff;
	color: #343434;
}
#passages {
	margin-left: 18.2em;
	border-left: 1px solid #333;
	padding-left: 1.5em;
	position:relative;
}
.passage {
	font-size: 1.2em;
	line-height: 175%;
	margin-bottom: 2em;
	text-align: left;
}
.passage ul {
	padding-top: 1.3em;
}
.passage li {
	margin-right: 6em;
}
.passage center {
	max-width:50%;
	margin:auto;
}
.passage a {
	color: #4d6ad8;
	font-weight: bold;
	text-decoration: none;
}
a.internalLink, a.externalLink, a.back, a.return {
	cursor: pointer;
}
.passage a:hover {
	color: #8ea6ff;
	text-decoration: underline;
}
a.brokenLink {
	background-color: red;
	text-decoration: none;
	color: #000;
}
.disabled {
	font-weight: bold;
	color: #333;
}
.marked {
	background-color: red;
	color: #000;
	margin-right: 12px;
	padding: 3px;
}
.marked[title] {
	cursor: help;
}
.passage ul {
	margin-left: .5em;
	padding-left: 1.5em;
}
.passage ol {
	margin-left: .5em;
	padding-left: 1.5em;
}
.passage table {
	border-collapse: collapse;
	font-size: 100%;
	margin: .8em 1.0em;
}
.passage th,.passage td,.passage tr,.passage caption {
	padding: 3px;
}
.passage hr {
	height: 1px;
}
input, button {
	background-color: #000;
	color:#fff;
	font-size: 1.2em;
}
button {
	border: 2px outset #333;
	border-radius:0.5em;
	padding: 0.2em 0.8em;
}
button:active {
	border-style:solid;
}
input[type=text] {
	border: 2px solid #333;
	width: 20%;
}
input[type=text]:hover {
	border-color: #fff;
}
#storeArea {
	display: none;
}
#noscript {
	margin-left: 18.2em;
	font-size: 1.2em;
	font-weight: bold;
}
img {
	vertical-align:bottom;
}
</style>
<style id="transitionCSS">
.transition-in {
	opacity:0;
	position:absolute;
}
.passage:not(.transition-out) {
	transition: 1s;
	-webkit-transition: 1s;
}
.transition-out {
	opacity:0 !important;
	position:absolute;
}
</style>
<style id="storyCSS"></style>
<style id="tagCSS"></style>
</head>
<body>
<ul id="sidebar">
<li id="title" class="storyElement"><span id="storyTitle" class="storyElement"></span><span id="storySubtitle" class="storyElement"></span><span id="titleSeparator"></span><span id="storyAuthor" class="storyElement"></span></li>
<li id="storyMenu" class="storyElement"></li>
<li id="snapback">Rewind</li>
<li id="restart">Restart</li>
<li><a id="bookmark" title="Permanent link to this passage">Bookmark</a></li>
<li id="credits">
This story was created with <a href="http://twinery.org/">Twine</a> and is powered by <a href="http://tiddlywiki.com/">TiddlyWiki</a>
</li>
</ul>
<div id="snapbackMenu" class="menu"></div>
<div id="passages">
<noscript><div id="noscript">Please enable Javascript to play this story!</div></noscript>
<style>#sidebar{display:none;}</style>
</div>
<div id="storeArea"><div tiddler="cave01" tags="" modified="201405251506" created="201405180145" twine-position="570,1130" modifier="twee">&lt;&lt;setback cavepanorama01.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave01&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;A beam of light shines down from above, where the floor collapsed beneath you.\nThere are three tunnels. Which way do you want to go?\n\n[[Left|cave06]]\n[[Right|cave04]]\n[[Middle|cave02]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave03" tags="" modified="201405232048" created="201405180157" twine-position="850,1270" modifier="twee">&lt;&lt;setback cavepanorama03.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave03&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 3&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave04]]\n[[Right|cave08]]\n[[Middle|cave07]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave02" tags="" modified="201405232054" created="201405180157" twine-position="570,1410" modifier="twee">&lt;&lt;setback cavepanorama02.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave02&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 2&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave07]]\n[[Right|cave05]]\n[[Middle|cave11]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave05" tags="" modified="201405251348" created="201405180204" twine-position="430,1550" modifier="twee">&lt;&lt;setback cavepanorama05.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave05&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 5&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 11) or ($randomKeyLocation eq 12)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 3) or ($randomKeyLocation eq 4) or ($randomKeyLocation eq 10)&gt;&gt;&lt;&lt;if $hint eq 1&gt;&gt;There is a [[piece of paper|hint]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave02]]\n[[Right|cave09]]\n[[Middle|cave06]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave04" tags="" modified="201405232047" created="201405180201" twine-position="710,1270" modifier="twee">&lt;&lt;setback cavepanorama04.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave04&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 4&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave01]]\n[[Right|cave03]]\n[[Middle|cave10]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave07" tags="" modified="201405251349" created="201405180205" twine-position="710,1550" modifier="twee">&lt;&lt;setback cavepanorama07.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave07&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 7) or ($randomKeyLocation eq 1)&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 5) or ($randomKeyLocation eq 6)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 8) or ($randomKeyLocation eq 9) or ($randomKeyLocation eq 11)&gt;&gt;&lt;&lt;if $hint eq 1&gt;&gt;There is a [[piece of paper|hint]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave10]]\n[[Right|cave02]]\n[[Middle|cave08]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="some snot-filled tissues" tags="" modified="201405261524" created="201405172022" twine-position="990,990" modifier="twee">&lt;&lt;if $roomTracker eq &quot;Mr Kelley tied up&quot;&gt;&gt;You try rubbing the snot-filled tissues on the silk, but you're just getting snot everywhere. Maybe you could try to use something sharp to cut through the rope-like silk? [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try smacking the snot-filled tissues against the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;\nYou use the snot-filled tissues to blow your nose and then put them back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Mr. Zeke's Room" tags="" modified="201405232124" created="201310072329" twine-position="990,290" modifier="twee">&lt;&lt;setback zena8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Zeke's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Zeke's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Zeke's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 11&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomKeyLocation eq 12&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 12) or ($randomKeyLocation+3 eq 13)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on his desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $tooth eq 0&gt;&gt;\nEww! Someone's [[tooth]] is on the floor!!! Gross!\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave08" tags="" modified="201405232050" created="201405180205" twine-position="990,1410" modifier="twee">&lt;&lt;setback cavepanorama08.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave08&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 8) or ($randomKeyLocation eq 12)&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 9) or ($randomKeyLocation eq 10)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave03]]\n[[Right|cave10]]\n[[Middle|cave04]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="old use weapon" tags="" modified="201405262035" created="201405262035" twine-position="290,150" modifier="twee">|[[Punch|use punch]]|[[Kick|use kick]]|&lt;&lt;if $scissors gt 0&gt;&gt;[[Scissors|use scissors]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $arrowhead gt 0&gt;&gt;[[Arrowhead|use arrowhead]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $stapler gt 0&gt;&gt;[[Stapler|use stapler]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $tooth gt 0&gt;&gt;[[Tooth|use tooth]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $tissues gt 0&gt;&gt;[[Tissues|use tissues]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $bandaid gt 0&gt;&gt;[[Bandaid|use bandaid]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $gymsocks gt 0&gt;&gt;[[Socks|use gym socks]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $hammer gt 0&gt;&gt;[[Hammer|use sledge hammer]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if $owlcall gt 0&gt;&gt;[[Owl Call|use owl call]]&lt;&lt;endif&gt;&gt;|</div><div tiddler="Free Mr Kelley with arrowhead" tags="" modified="201405232126" created="201405190017" twine-position="290,1690" modifier="twee">You use the arrowhead to cut through the spider silk! It takes a little time but soon you've uncovered Mr. Kelley's mouth. &quot;&lt;&lt;$name&gt;&gt;! Thank goodness you came! I almost got to review the arachnid anatomy FROM THE INSIDE! Anyway... I've discovered [[SOMETHING REALLY FACINATING]]!&quot;</div><div tiddler="use gym socks" tags="" modified="201405232043" created="201311011159" twine-position="1130,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 12 + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SLAP the spider with the sweaty gym socks. Gross! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(10-$level)) eq 1&gt;&gt;You accidentally dropped the gym socks and lost them.&lt;&lt;silently&gt;&gt;&lt;&lt;set $gymsocks -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[someone's sweaty gym socks]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Replace Macros CSS" tags="stylesheet" modified="201405171519" created="201310072235" twine-position="710,10" modifier="twee">.revision-span-in {\n\topacity: 0;\n}\n.revision-span:not(.revision-span-out) {\n\ttransition: 1s; -webkit-transition: 1s;\n}\n.revision-span-out {\n\tposition:absolute;\n\topacity: 0;\n}</div><div tiddler="use tissues" tags="" modified="201405232043" created="201311011159" twine-position="990,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 12 + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SLAP the spider with the snot-filled tissues. Gross! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(10-$level)) eq 1&gt;&gt;You accidentally dropped the tissues and lost them.&lt;&lt;silently&gt;&gt;&lt;&lt;set $tissues -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[some snot-filled tissues]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="hint" tags="" modified="201406082107" created="201405251344" twine-position="1270,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $hint = 0&gt;&gt;&lt;&lt;endsilently&gt;&gt;The piece of paper says, //&quot;Here's a hint... &lt;&lt;if $randomHint is 1&gt;&gt;Collect every item that you can. Items can be used as weapons or can give you health. The bandaid can do both.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 2&gt;&gt;Some weapons are more powerful than others. Unfortunately, the more powerful the weapon, the easier it is to break/drop. Save the most powerful weapons for as long as you can.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 3&gt;&gt;The arrowhead and the scissors can be used to pry open a teacher's desk or to cut through rope-like material.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 4&gt;&gt;In some games, kicking does more damage than punching. In other games, the opposite is true.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 5&gt;&gt;The sledge hammer is a unique weapon. It's indestructable (you can't break/drop it) until after you've used it to smash through the boulder.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 6&gt;&gt;If you still have the arrowhead or the scissors towards the end of the game, you can use them to cut through something rope-like and you will receive a VERY powerful weapon.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 7&gt;&gt;Don't underestimate the used bandaid, used tissues, and the gym socks. On average, these weapons are actually more powerful than the sledge hammer.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 8&gt;&gt;There are four ways to get more health: two first aid kits, one suit of armor, and the bandaid. When not in a battle, clicking on the bandaid lets you to use it to heal.&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomHint is 9&gt;&gt;Time is an important part of your score. Complete the game as quickly as possible for the highest score.&lt;&lt;endif&gt;&gt;&lt;&lt;set $points += 50&gt;&gt;&quot;//&lt;&lt;endif&gt;&gt;\n[[Return]]</div><div tiddler="workers" tags="" modified="201405240023" created="201405240003" twine-position="990,1550" modifier="twee">&quot;Minor worker ants, or simply 'workers', are the most common ant found in any colony. These sterile female ants are the smallest ant, but they do the most work. Some workers look after the queen and brood, some forage for food from around the nest, whilst others maintain and expand the nest. Workers can live between a few months and up to five years.&quot;\n\n&quot;Several species of spider including Achaearanea Wau and Anelosimus Eximius swarm in an analogous way to ants, bees and wasps.&quot;\n\n&lt;&lt;return&gt;&gt;</div><div tiddler="cave06" tags="" modified="201405232055" created="201405180204" twine-position="430,1270" modifier="twee">&lt;&lt;setback cavepanorama06.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave06&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 6&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 1) or ($randomKeyLocation eq 2)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave11]]\n[[Right|cave01]]\n[[Middle|cave09]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="a tooth" tags="" modified="201405281802" created="201405171726" twine-position="570,990" modifier="twee">&lt;&lt;if $roomTracker eq &quot;Mr Kelley tied up&quot;&gt;&gt;You try using the tooth to cut apart the silk, but the tooth is just too dull. Maybe you could try to use something sharp to cut through the rope-like silk? [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try smacking the tooth against the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;\nYou take the tooth out of your pocket, but you can't use it, so you put it back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="a queen" tags="" modified="201405251434" created="201405190055" twine-position="990,1690" modifier="twee">&quot;What if I defeat the spider queen?&quot; you ask.\n\n&quot;When an ant colony loses its queen, whether through old age, rebellion, human interaction, or tragic natural circumstances, [[the colony is pretty much doomed]].&quot;</div><div tiddler="cave09" tags="" modified="201405251350" created="201405180207" twine-position="290,1550" modifier="twee">&lt;&lt;setback cavepanorama09.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave09&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 9)&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 3) or ($randomKeyLocation eq 4)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 1) or ($randomKeyLocation eq 7) or ($randomKeyLocation eq 12)&gt;&gt;&lt;&lt;if $hint eq 1&gt;&gt;There is a [[piece of paper|hint]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave05]]\n[[Right|cave12]]\n[[Middle|cave02]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="this hypothesis" tags="" modified="201405202151" created="201405190037" twine-position="710,1690" modifier="twee">&lt;img src=&quot;science.gif&quot;&gt;\n&quot;...this hypothesis that through selective breeding, spiders could be tamed... or even... domesticated. After a few rounds of selective breeding, the spiders remained hostile to humans, but became more social to each other and eventually aggregated into [[an ant-like swarm]]! It was scientifically ground-breaking!&quot;</div><div tiddler="StoryTitle" tags="" modified="201310071238" created="201310071238" twine-position="150,10" modifier="twee">Sundown</div><div tiddler="first aid kit" tags="" modified="201405222318" created="201405212149" twine-position="570,150" modifier="twee">//+25 health//\n[[Return]]&lt;&lt;set $firstaidkit -=1&gt;&gt;&lt;&lt;set $health +=25&gt;&gt;&lt;&lt;set $points +=25&gt;&gt;</div><div tiddler="Replace Macros" tags="script" modified="201310072235" created="201310072235" twine-position="850,10" modifier="twee">(function(){version.extensions.replaceMacrosCombined={major:1,minor:1,revision:0};\nvar nullobj={handler:function(){}};function showVer(n,notrans){n.innerHTML=&quot;&quot;;\nnew Wikifier(n,n.tweecode);n.setAttribute(&quot;data-enabled&quot;,&quot;true&quot;);\nn.style.display=&quot;inline&quot;;n.classList.remove(&quot;revision-span-out&quot;);\nif(!notrans){n.classList.add(&quot;revision-span-in&quot;);if(n.timeout){clearTimeout(n.timeout)\n}n.timeout=setTimeout(function(){n.classList.remove(&quot;revision-span-in&quot;);\nn=null},1)}}function hideVer(n,notrans){n.setAttribute(&quot;data-enabled&quot;,&quot;false&quot;);\nn.classList.remove(&quot;revision-span-in&quot;);if(n.timeout){clearTimeout(n.timeout)\n}if(!notrans){n.classList.add(&quot;revision-span-out&quot;);n.timeout=setTimeout(function(){if(n.getAttribute(&quot;data-enabled&quot;)==&quot;false&quot;){n.classList.remove(&quot;revision-span-out&quot;);\nn.style.display=&quot;none&quot;;n.innerHTML=&quot;&quot;}n=null},1000)}else{n.style.display=&quot;none&quot;;\nn.innerHTML=&quot;&quot;;n=null}}function tagcontents(b,starttags,desttags,endtags,k){var l=0,c=&quot;&quot;,tg,a,i;\nfunction tagfound(i,e){for(var j=0;j&lt;e.length;j++){if(a.indexOf(&quot;&lt;&lt;&quot;+e[j],i)==i){return e[j]\n}}}a=b.source.slice(k);for(i=0;i&lt;a.length;i++){if(tg=tagfound(i,starttags)){l++\n}else{if((tg=tagfound(i,desttags))&&l==0){b.nextMatch=k+i+tg.length+4;\nreturn[c,tg]}else{if(tg=tagfound(i,endtags)){l--;if(l&lt;0){return null\n}}}}c+=a.charAt(i)}return null}var begintags=[];var endtags=[];\nfunction revisionSpanHandler(g,e,f,b){var k=b.source.indexOf(&quot;&gt;&gt;&quot;,b.matchStart)+2,vsns=[],vtype=e,flen=f.length,becomes,c,cn,m,h,vsn;\nfunction mkspan(vtype){h=insertElement(m,&quot;span&quot;,null,&quot;revision-span &quot;+vtype);\nh.setAttribute(&quot;data-enabled&quot;,false);h.style.display=&quot;none&quot;;h.tweecode=&quot;&quot;;\nreturn h}if(this.shorthand&&flen){while(f.length&gt;0){vsns.push([f.shift(),(this.flavour==&quot;insert&quot;?&quot;gains&quot;:&quot;becomes&quot;)])\n}}else{if(this.flavour==&quot;insert&quot;||(this.flavour==&quot;continue&quot;&&this.trigger==&quot;time&quot;)){vsns.push([&quot;&quot;,&quot;becomes&quot;])\n}}if(this.flavour==&quot;continue&quot;&&flen){b.nextMatch=k+b.source.slice(k).length;\nvsns.push([b.source.slice(k),vtype])}else{becomes=[&quot;becomes&quot;,&quot;gains&quot;];\nc=tagcontents(b,begintags,becomes.concat(endtags),endtags,k);\nif(c&&endtags.indexOf(c[1])==-1){while(c){vsns.push(c);c=tagcontents(b,begintags,becomes,endtags,b.nextMatch)\n}c=tagcontents(b,begintags,[&quot;end&quot;+e],endtags,b.nextMatch)}if(!c){throwError(g,&quot;can't find matching end&quot;+e);\nreturn}vsns.push(c);if(this.flavour==&quot;continue&quot;){k=b.nextMatch;\nb.nextMatch=k+b.source.slice(k).length;vsns.push([b.source.slice(k),&quot;&quot;])\n}}if(this.flavour==&quot;remove&quot;){vsns.push([&quot;&quot;,&quot;becomes&quot;])}cn=0;m=insertElement(g,&quot;span&quot;,null,e);\nm.setAttribute(&quot;data-flavour&quot;,this.flavour);h=mkspan(&quot;initial&quot;);\nvsn=vsns.shift();h.tweecode=vsn[0];showVer(h,true);while(vsns.length&gt;0){if(vsn){vtype=vsn[1]\n}vsn=vsns.shift();h=mkspan(vtype);h.tweecode=vsn[0]}if(typeof this.setup==&quot;function&quot;){this.setup(m,g,f)\n}}function quantity(m){return(m.children.length-1)+(m.getAttribute(&quot;data-flavour&quot;)==&quot;remove&quot;)\n}function revisionSetup(m,g,f){m.className+=&quot; &quot;+f[0].replace(&quot; &quot;,&quot;_&quot;)\n}function keySetup(m,g,f){var fl=this.flavour,key=f[0];m.setEventListener(&quot;keydown&quot;,function l(e){var done=!revise(&quot;revise&quot;,m);\nif(done){m.removeEventListener(&quot;keydown&quot;,l)}})}function timeSetup(m,g,f){function cssTimeUnit(s){if(typeof s==&quot;string&quot;){if(s.slice(-2).toLowerCase()==&quot;ms&quot;){return Number(s.slice(0,-2))||0\n}else{if(s.slice(-1).toLowerCase()==&quot;s&quot;){return Number(s.slice(0,-1))*1000||0\n}}}throwError(g,s+&quot; isn't a CSS time unit&quot;);return 0}var fl=this.flavour;\nvar tm=cssTimeUnit(f[0]);setTimeout(function timefn(){var done=!revise(&quot;revise&quot;,m);\nif(!done){setTimeout(timefn,tm)}},tm)}function hoverSetup(m){m.onmouseover=function(){revise(&quot;revise&quot;,this)\n};m.onmouseout=function(){revise(&quot;revert&quot;,this)};m=null}function mouseSetup(m){var fl=this.flavour,evt=(window.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;);\nm[evt]=function(){var done=!revise(&quot;revise&quot;,this);if(done){this[evt]=null\n}};m=null}function linkSetup(m,g,f){var fl=this.flavour,l=Wikifier.createInternalLink(),p=m.parentNode;\nl.className=&quot;internalLink replaceLink&quot;;p.insertBefore(l,m);l.insertBefore(m,null);\nl.onclick=function(){var p,done=false;if(m&&m.parentNode==this){done=!revise(&quot;revise&quot;,m);\nscrollWindowTo(m)}if(done){this.parentNode.insertBefore(m,this);\nthis.parentNode.removeChild(this)}};l=null}function visitedSetup(m,g,f){var i,done,shv=state.history[0].variables,os=&quot;once seen&quot;,d=(m.firstChild&&(this.flavour==&quot;insert&quot;?m.firstChild.nextSibling:m.firstChild).tweecode);\nshv[os]=shv[os]||{};if(d&&!shv[os].hasOwnProperty(d)){shv[os][d]=1\n}else{for(i=shv[os][d];i&gt;0&&!done;i--){done=!revise(&quot;revise&quot;,m,true)\n}if(shv[os].hasOwnProperty(d)){shv[os][d]+=1}}}[{name:&quot;insert&quot;,flavour:&quot;insert&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedinsert&quot;,flavour:&quot;insert&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;insertion&quot;,flavour:&quot;insert&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;later&quot;,flavour:&quot;insert&quot;,trigger:&quot;visited&quot;,setup:visitedSetup},{name:&quot;keyinsert&quot;,flavour:&quot;insert&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;replace&quot;,flavour:&quot;replace&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousereplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;revision&quot;,flavour:&quot;replace&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;keyreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;timedremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mouseremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;removal&quot;,flavour:&quot;remove&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;once&quot;,flavour:&quot;remove&quot;,trigger:&quot;visited&quot;,setup:visitedSetup},{name:&quot;keyremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;continue&quot;,flavour:&quot;continue&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedcontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousecontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;keycontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;cycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;mousecycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;timedcycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;keycycle&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup}].forEach(function(e){e.handler=revisionSpanHandler;\ne.shorthand=([&quot;link&quot;,&quot;mouse&quot;,&quot;hover&quot;].indexOf(e.trigger)&gt;-1);\nmacros[e.name]=e;macros[&quot;end&quot;+e.name]=nullobj;begintags.push(e.name);\nendtags.push(&quot;end&quot;+e.name)});function insideDepartingSpan(elem){var r=elem.parentNode;\nwhile(!r.classList.contains(&quot;passage&quot;)){if(r.classList.contains(&quot;revision-span-out&quot;)){return true\n}r=r.parentNode}}function reviseAll(rt,rname){var rall=document.querySelectorAll(&quot;.passage .&quot;+rname),ret=false;\nfor(var i=0;i&lt;rall.length;i++){if(!insideDepartingSpan(rall[i])){ret=revise(rt,rall[i])||ret\n}}return ret}function revise(rt,r,notrans){var ind2,curr,next,ind=-1,rev=(rt==&quot;revert&quot;),rnd=(rt.indexOf(&quot;random&quot;)&gt;-1),fl=r.getAttribute(&quot;data-flavour&quot;),rc=r.childNodes,cyc=(fl==&quot;cycle&quot;),rcl=rc.length-1;\nfunction doToGainerSpans(n,fn){for(var k=n-1;k&gt;=0;k--){if(rc[k+1].classList.contains(&quot;gains&quot;)){fn(rc[k],notrans)\n}else{break}}}for(var k=0;k&lt;=rcl;k++){if(rc[k].getAttribute(&quot;data-enabled&quot;)==&quot;true&quot;){ind=k\n}}if(rev){ind-=1}curr=(ind&gt;=0?rc[ind]:(cyc?rc[rcl]:null));ind2=ind;\nif(rnd){ind2=(ind+(Math.floor(Math.random()*rcl)))%rcl}next=((ind2&lt;rcl)?rc[ind2+1]:(cyc?rc[0]:null));\nvar docurr=(rev?showVer:hideVer);var donext=(rev?hideVer:showVer);\nvar currfn=function(){if(!(next&&next.classList.contains(&quot;gains&quot;))||rnd){docurr(curr,notrans);\ndoToGainerSpans(ind,docurr,notrans)}};var nextfn=function(){donext(next,notrans);\nif(rnd){doToGainerSpans(ind2+1,donext,notrans)}};if(!rev){currfn();\nnextfn()}else{nextfn();currfn()}return(cyc?true:(rev?(ind&gt;0):(ind2&lt;rcl-1)))\n}macros.revert=macros.revise=macros.randomise=macros.randomize={handler:function(a,b,c){var l,rev,rname;\nfunction disableLink(l){l.style.display=&quot;none&quot;}function enableLink(l){l.style.display=&quot;inline&quot;\n}function updateLink(l){if(l.className.indexOf(&quot;random&quot;)&gt;-1){enableLink(l);\nreturn}var rall=document.querySelectorAll(&quot;.passage .&quot;+rname),cannext,canprev,i,ind,r,fl;\nfor(i=0;i&lt;rall.length;i++){r=rall[i],fl=r.getAttribute(&quot;data-flavour&quot;);\nif(insideDepartingSpan(r)){continue}if(fl==&quot;cycle&quot;){cannext=canprev=true\n}else{if(r.firstChild.getAttribute(&quot;data-enabled&quot;)==!1+&quot;&quot;){canprev=true\n}if(r.lastChild.getAttribute(&quot;data-enabled&quot;)==!1+&quot;&quot;){cannext=true\n}}}var can=(l.classList.contains(&quot;revert&quot;)?canprev:cannext);(can?enableLink:disableLink)(l)\n}function toggleText(w){w.classList.toggle(rl+&quot;Enabled&quot;);w.classList.toggle(rl+&quot;Disabled&quot;);\nw.style.display=((w.style.display==&quot;none&quot;)?&quot;inline&quot;:&quot;none&quot;)}var rl=&quot;reviseLink&quot;;\nif(c.length&lt;2){throwError(a,b+&quot; macro needs 2 parameters&quot;);return\n}rname=c.shift().replace(&quot; &quot;,&quot;_&quot;);l=Wikifier.createInternalLink(a,null);\nl.className=&quot;internalLink &quot;+rl+&quot; &quot;+rl+&quot;_&quot;+rname+&quot; &quot;+b;var v=&quot;&quot;;\nvar end=false;var out=false;if(c.length&gt;1&&c[0][0]==&quot;$&quot;){v=c[0].slice(1);\nc.shift()}switch(c[c.length-1]){case&quot;end&quot;:end=true;c.pop();break;\ncase&quot;out&quot;:out=true;c.pop();break}var h=state.history[0].variables;\nfor(var i=0;i&lt;c.length;i++){var on=(i==Math.max(c.indexOf(h[v]),0));\nvar d=insertElement(null,&quot;span&quot;,null,rl+((on)?&quot;En&quot;:&quot;Dis&quot;)+&quot;abled&quot;);\nif(on){h[v]=c[i];l.setAttribute(&quot;data-cycle&quot;,i)}else{d.style.display=&quot;none&quot;\n}insertText(d,c[i]);l.appendChild(d)}l.onclick=function(){reviseAll(b,rname);\nvar t=this.childNodes,u=this.getAttribute(&quot;data-cycle&quot;)-0,m=t.length,n,lall,i;\nif((end||out)&&u==m-(end?2:1)){if(end){n=this.removeChild(t[u+1]);\nn.className=rl+&quot;End&quot;;n.style.display=&quot;inline&quot;;this.parentNode.replaceChild(n,this)\n}else{this.parentNode.removeChild(this);return}}else{toggleText(t[u]);\nu=(u+1)%m;if(v){h[v]=c[u]}toggleText(t[u]);this.setAttribute(&quot;data-cycle&quot;,u)\n}lall=document.getElementsByClassName(rl+&quot;_&quot;+rname);for(i=0;i&lt;lall.length;\ni++){updateLink(lall[i])}};disableLink(l);setTimeout(function(){updateLink(l);\nl=null},1)}};macros.mouserevise=macros.hoverrevise={handler:function(a,b,c,d){var endtags=[&quot;end&quot;+b],evt=(window.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;),t=tagcontents(d,[b],endtags,endtags,d.source.indexOf(&quot;&gt;&gt;&quot;,d.matchStart)+2);\nif(t){var rname=c[0].replace(&quot; &quot;,&quot;_&quot;),h=insertElement(a,&quot;span&quot;,null,&quot;hoverrevise hoverrevise_&quot;+rname),f=function(){var done=!reviseAll(&quot;revise&quot;,rname);\nif(b!=&quot;hoverrevise&quot;&&done){this[evt]=null}};new Wikifier(h,t[0]);\nif(b==&quot;hoverrevise&quot;){h.onmouseover=f;h.onmouseout=function(){reviseAll(&quot;revert&quot;,rname)\n}}else{h[evt]=f}h=null}}};macros.instantrevise={handler:function(a,b,c,d){reviseAll(&quot;revise&quot;,c[0].replace(&quot; &quot;,&quot;_&quot;))\n}};macros.endmouserevise=nullobj;macros.endhoverrevise=nullobj\n}());</div><div tiddler="stapler" tags="" modified="201406082105" created="201310082117" twine-position="290,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $stapler = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a stapler]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the stapler and put it in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="pry scissors" tags="" modified="201405172222" created="201405172117" twine-position="710,990" modifier="twee">&lt;&lt;set $diceroll = Math.ceil(Math.random()*5)&gt;&gt;&lt;&lt;set $money = $money + $diceroll&gt;&gt;&lt;&lt;set $scissors -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a pair of scissors]]&quot;),1)&gt;&gt;You found $&lt;&lt;$diceroll&gt;&gt; in the teacher's desk. Unfortunately, you broke the scissors in the process.\n&lt;&lt;display &quot;Building A&quot;&gt;&gt;</div><div tiddler="display Macro" tags="script" modified="201405180201" created="201405180201" twine-position="1130,150" modifier="twee">try { \n        macros['display'].handler = function (a,b,c,d){ \n                        try { \n                                new \nWikifier(a,tale.get(eval(d.fullArgs())).text) \n                        } catch(e) { \n                                new Wikifier(a,tale.get(c[0]).text) \n                        } \n                } \n} catch(e) { throwError(place,&quot;Error in Custom Macros Code!&quot;); } </div><div tiddler="use bandaid" tags="" modified="201405232043" created="201311011158" twine-position="850,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 12 + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SLAP the spider with the used bandaid. Gross! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(10-$level)) eq 1&gt;&gt;You accidentally dropped the bandaid and lost it.&lt;&lt;silently&gt;&gt;&lt;&lt;set $bandaid -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[someone's used bandaid]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="an owl call" tags="" modified="201405190108" created="201405190108" twine-position="1410,990" modifier="twee">You blow into the owl call, but nothing happens.\n[[Return]]</div><div tiddler="Miss Abigail's Room" tags="" modified="201405232358" created="201310072250" twine-position="10,290" modifier="twee">&lt;&lt;setback abdiaziz8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Miss Abigail's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*5) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Miss Abigail's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Miss Abigail's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 1&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on her desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $scissors eq 0&gt;&gt;\nThere is a pair of [[scissors]] on her desk.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Free Mr Kelley with scissors" tags="" modified="201405232125" created="201405190027" twine-position="430,1690" modifier="twee">You use the scissors to cut through the spider silk! It takes a little time but soon you've uncovered Mr. Kelley's mouth. &quot;&lt;&lt;$name&gt;&gt;! Thank goodness you came! I almost got to review the arachnid anatomy FROM THE INSIDE! Anyway... I've discovered [[SOMETHING REALLY FACINATING]]!&quot;</div><div tiddler="soldiers" tags="" modified="201405240024" created="201405240008" twine-position="1130,1550" modifier="twee">&quot;Soldier ants are also known as major workers or big heads. These sterile female ants are larger and stronger than typical workers. They protect their colony from large predators and use their strength and large jaws or mandibles to cut and carry larger objects.&quot;\n\n&quot;Several species of spider including Achaearanea Wau and Anelosimus Eximius swarm in an analogous way to ants, bees and wasps.&quot;\n\n&lt;&lt;return&gt;&gt;</div><div tiddler="SOMETHING REALLY FACINATING" tags="" modified="201405232126" created="201405190029" twine-position="570,1690" modifier="twee">&lt;img src=&quot;science01.gif&quot;&gt;\n&quot;Ok... well, most spiders are solitary creatures and will even show aggression towards other members of their own species,&quot; he continues. &quot;We were working with [[this hypothesis]]...&quot;</div><div tiddler="Mr. Shaquille's Room" tags="" modified="201405232121" created="201310072311" twine-position="290,290" modifier="twee">&lt;&lt;setback shahira8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Shaquille's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*5) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Shaquille's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Shaquille's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 3&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on hia desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $armor eq 0&gt;&gt;\nThere is a medival coat of [[armor]] next to his desk.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave17" tags="" modified="201405251435" created="201405202125" twine-position="430,1830" modifier="twee">&lt;&lt;set $level = 4&gt;&gt;&lt;&lt;set $bossHealth=100&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $points += 500&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave16&quot;&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;&lt;playsound &quot;sfx1.mp3&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;playsound &quot;sfx2.mp3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\nYOU'VE FOUND THE SPIDER QUEEN!\n&lt;&lt;display &quot;boss hit&quot;&gt;&gt;</div><div tiddler="enemy image" tags="" modified="201405181451" created="201405180009" twine-position="290,710" modifier="twee">&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;img src=&quot;spidey02.gif&quot;&gt;&lt;&lt;else&gt;&gt;&lt;img src=&quot;spidey01.gif&quot;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Building A" tags="" modified="201405212124" created="201310071220" twine-position="150,150" modifier="twee">&lt;&lt;silently&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;Building A&quot;&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;if $roomCounter lt $attackpause&gt;&gt;&lt;&lt;setback buildinga8bit.jpg&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\nYou are standing in the hallway of Building A at Sundown Academy.\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*4) gt 1&gt;&gt;&lt;&lt;setback buildinga8bit.jpg&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\nYou are standing in the hallway of Building A at Sundown Academy.\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="use sledge hammer" tags="" modified="201405251418" created="201405182309" twine-position="1270,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = Math.ceil(Math.random()*28)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SMACK the spider with the sledge hammer. //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if ($level gt 2) and (Math.ceil(Math.random()*(9-$level)) eq 1)&gt;&gt;You accidentally dropped the sledge hammer and lost it.&lt;&lt;silently&gt;&gt;&lt;&lt;set $hammer -= 2&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a sledge hammer]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Mr. Tubman's Room" tags="" modified="201405232121" created="201310072327" twine-position="710,290" modifier="twee">&lt;&lt;setback tabassum8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Tubman's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Tubman's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Tubman's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 7&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomKeyLocation eq 8&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 8) or ($randomKeyLocation+3 eq 9)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on his desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $tissues eq 0&gt;&gt;\nGross. There are some snot-filled, used [[tissues]] on the floor.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Principal Redwood's Office" tags="" modified="201405262211" created="201310072329" twine-position="10,430" modifier="twee">&lt;&lt;setback&gt;&gt;The door is locked.\nDo you want to use the key to try to open Principal Redwood's Office?\n@@margin:0 0 0 30px;[[Return]] @@ @@margin:0 0 0 30px;[[Use it|cave0]] @@</div><div tiddler="score" tags="" modified="201405230020" created="201405222319" twine-position="1410,1830" modifier="twee">&lt;&lt;set $time = (new Date().getTime()-$time)*0.00001&gt;&gt;&lt;&lt;set $points = Math.ceil((($points+$health+$money+$roomCounter)/$time)*$level)&gt;&gt;Your score: &lt;&lt;$points&gt;&gt;\n&lt;html&gt;&lt;div class=&quot;ss-form&quot;&gt;&lt;form action=&quot;https://docs.google.com/forms/d/1QBuGORqy__91BBFmShc_EZYqK4jVBwVBd8mp5k9pQVM/formResponse&quot; method=&quot;POST&quot; id=&quot;ss-form&quot; target=&quot;_self&quot; onsubmit=&quot;&quot;&gt;&lt;ol role=&quot;list&quot; class=&quot;ss-question-list&quot; style=&quot;padding-left: 0&quot;&gt;\n&lt;div class=&quot;ss-form-question errorbox-good&quot; role=&quot;listitem&quot;&gt;\n&lt;div dir=&quot;ltr&quot; class=&quot;ss-item  ss-text&quot;&gt;&lt;div class=&quot;ss-form-entry&quot;&gt;\n&lt;label class=&quot;ss-q-item-label&quot; for=&quot;entry_892881495&quot;&gt;&lt;div class=&quot;ss-q-title&quot;&gt;\n&lt;/div&gt;\n&lt;div class=&quot;ss-q-help ss-secondary-text&quot; dir=&quot;ltr&quot;&gt;&lt;/div&gt;&lt;/label&gt;\n&lt;input type=&quot;hidden&quot; name=&quot;entry.892881495&quot; value=&quot;&quot; class=&quot;ss-q-short&quot; id=&quot;entry_892881495&quot; dir=&quot;auto&quot; aria-label=&quot;Name:  &quot; title=&quot;&quot;&gt;\n&lt;div class=&quot;error-message&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;div class=&quot;ss-form-question errorbox-good&quot; role=&quot;listitem&quot;&gt;\n&lt;div dir=&quot;ltr&quot; class=&quot;ss-item  ss-text&quot;&gt;&lt;div class=&quot;ss-form-entry&quot;&gt;\n&lt;label class=&quot;ss-q-item-label&quot; for=&quot;entry_515172766&quot;&gt;&lt;div class=&quot;ss-q-title&quot;&gt;\n&lt;/div&gt;\n&lt;div class=&quot;ss-q-help ss-secondary-text&quot; dir=&quot;ltr&quot;&gt;&lt;/div&gt;&lt;/label&gt;\n&lt;input type=&quot;hidden&quot; name=&quot;entry.515172766&quot; value=&quot;&quot; class=&quot;ss-q-short&quot; id=&quot;entry_515172766&quot; dir=&quot;auto&quot; aria-label=&quot;Score:  &quot; title=&quot;&quot;&gt;\n&lt;div class=&quot;error-message&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;\n&lt;input type=&quot;hidden&quot; name=&quot;draftResponse&quot; value=&quot;[,,&quot;3539647121836391273&quot;]\n&quot;&gt;\n&lt;input type=&quot;hidden&quot; name=&quot;pageHistory&quot; value=&quot;0&quot;&gt;\n\n\n&lt;input type=&quot;hidden&quot; name=&quot;fbzx&quot; value=&quot;3539647121836391273&quot;&gt;\n\n&lt;div class=&quot;ss-item ss-navigate&quot;&gt;&lt;table id=&quot;navigation-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;ss-form-entry goog-inline-block&quot; id=&quot;navigation-buttons&quot; dir=&quot;ltr&quot;&gt;\n&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;High Scores&quot; id=&quot;ss-submit&quot;&gt;\n&lt;/td&gt;\n&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/ol&gt;&lt;/form&gt;&lt;/div&gt;&lt;/html&gt;&lt;&lt;googleForms $name $points&gt;&gt;</div><div tiddler="Screen Shake" tags="script" modified="201406081917" created="201310072217" twine-position="990,10" modifier="twee">\n// the screenShake macro. Adapted from Emmanuel Turner's article on creating Twine macros. http://eturnerx.blogspot.com/2012/12/how-to-create-custom-macros-in-twine.html\ntry {\n  version.extensions['screenShakeMacro'] = {\n    major: 1,\n    minor: 0,\n    revision: 0\n  };\n  macros['screenShake'] = {\n    handler: function (place, macroName, params, parser) {\n      var time = parseInt(params[0]);\n      if (typeof time !== 'number') {\n        time = 0;\n      }\n\nvar el = document.body;\n  baz = el;\n  console.log(baz[0]);\n  document.body.className = 'shake';\n  if (time &gt; 0) {\n    setTimeout(function(){document.body.className = ''}, time);\n  };\n\n      // we're overriding the fade function. It behaves as usual except it runs screenShake() if time &gt;= 0.\n      fade = function (el, options) {\n        var current;\n        var proxy = el.cloneNode(true);\n        var direction = (options.fade == 'in') ? 1 : -1;\n \n        el.parentNode.replaceChild(proxy, el);\n \n        if (options.fade == 'in') {\n          current = 0;\n          proxy.style.visibility = 'visible';\n        } else current = 1;\n \n        setOpacity(proxy, current);\n        var interval = window.setInterval(tick, 25);\n \n        function tick() {\n          current += 0.05 * direction;\n \n          setOpacity(proxy, Math.easeInOut(current));\n \n          if (((direction == 1) && (current &gt;= 1)) || ((direction == -1) && (current &lt;= 0))) {\n            console.log('swapping fader proxy out');\n            el.style.visibility = (options.fade == 'in') ? 'visible' : 'hidden';\n            proxy.parentNode.replaceChild(el, proxy);\n            delete proxy;\n            window.clearInterval(interval);\n \n            if (options.onComplete) options.onComplete();\n \n            if (time &gt;= 0) {\n\n              time = -1;\n            }\n \n          }\n        };\n \n        function setOpacity(el, opacity) {\n          var percent = Math.floor(opacity * 100);\n \n          // IE\n          el.style.zoom = 1;\n          el.style.filter = 'alpha(opacity=' + percent + ')';\n \n          // CSS 3\n          el.style.opacity = opacity;\n        };\n      };\n    },\n    init: function () {},\n  };\n} catch (e) {\n  throwError(place, &quot;screenShake Setup Error: &quot; + e.message);\n}</div><div tiddler="someone's sweaty gym socks" tags="" modified="201405261524" created="201405172023" twine-position="1130,990" modifier="twee">&lt;&lt;if $roomTracker eq &quot;Mr Kelley tied up&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try smacking the sweathy gym socks against the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;\nYou take the sweaty gym socks out of your pocket, but you can't use them, so you put them back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="shakey" tags="" modified="201406201324" created="201310080048" twine-position="850,150" modifier="twee">&lt;&lt;if $roomCounter eq 5&gt;&gt;&lt;&lt;screenShake 300&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 6&gt;&gt;&lt;&lt;screenShake 350&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 7&gt;&gt;&lt;&lt;screenShake 400&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 8&gt;&gt;&lt;&lt;screenShake 700&gt;&gt;&quot;What was that shaking?!&quot; You say to yourself.&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 9&gt;&gt;&lt;&lt;screenShake 1000&gt;&gt;&quot;DID ANYONE ELSE FEEL THE BUILDING SHAKING?!&quot; You yell. No one answers. &quot;Maybe I'm just imagining it,&quot; you say to yourself.&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 10&gt;&gt;&lt;&lt;screenShake 1400&gt;&gt;&quot;EARTHQUAKE!!!&quot; You yell. No one answers. The shaking seems to have stopped.&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 11&gt;&gt;&lt;&lt;screenShake 1200&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 12&gt;&gt;&lt;&lt;screenShake 1000&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 13&gt;&gt;&lt;&lt;screenShake 800&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 14&gt;&gt;&lt;&lt;screenShake 600&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomCounter eq 15&gt;&gt;&lt;&lt;screenShake 400&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="sledge hammer" tags="" modified="201405190124" created="201405182304" twine-position="1270,710" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $hammer = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a sledge hammer]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the sledge hammer.&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;unmutesound &quot;track4.mp3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n[[Return]]</div><div tiddler="gym socks" tags="" modified="201406082106" created="201310082152" twine-position="1130,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $gymsocks = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[someone's sweaty gym socks]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the sweaty gym socks and put them in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="key" tags="" modified="201406201329" created="201310082128" twine-position="710,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $key = 1&gt;&gt;&lt;&lt;unmutesound &quot;track2.mp3&quot;&gt;&gt;&lt;&lt;set $inv.push(&quot; a key&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the key and put it in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="shakeit css" tags="stylesheet" modified="201406081507" created="201310072216" twine-position="570,10" modifier="twee">@keyframes shakeit {\n  0% { transform: translate(2px, 1px) rotate(0deg); }\n\t10% { transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { transform: translate(0px, 2px) rotate(0deg); }\n\t40% { transform: translate(1px, -1px) rotate(1deg); }\n\t50% { transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { transform: translate(2px, 2px) rotate(0deg); }\n\t100% { transform: translate(1px, -2px) rotate(-1deg); }\n}\n \n@-o-keyframes shakeit {\n\t0% { -o-transform: translate(2px, 1px) rotate(0deg); }\n\t10% { -o-transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { -o-transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { -o-transform: translate(0px, 2px) rotate(0deg); }\n\t40% { -o-transform: translate(1px, -1px) rotate(1deg); }\n\t50% { -o-transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { -o-transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { -o-transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { -o-transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { -o-transform: translate(2px, 2px) rotate(0deg); }\n\t100% { -o-transform: translate(1px, -2px) rotate(-1deg); }\n}\n \n@-webkit-keyframes shakeit {\n\t0% { -webkit-transform: translate(2px, 1px) rotate(0deg); }\n\t10% { -webkit-transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { -webkit-transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { -webkit-transform: translate(0px, 2px) rotate(0deg); }\n\t40% { -webkit-transform: translate(1px, -1px) rotate(1deg); }\n\t50% { -webkit-transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { -webkit-transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { -webkit-transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { -webkit-transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { -webkit-transform: translate(2px, 2px) rotate(0deg); }\n\t100% { -webkit-transform: translate(1px, -2px) rotate(-1deg); }\n}\n \n@-moz-keyframes shakeit {\n\t0% { -moz-transform: translate(2px, 1px) rotate(0deg); }\n\t10% { -moz-transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { -moz-transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { -moz-transform: translate(0px, 2px) rotate(0deg); }\n\t40% { -moz-transform: translate(1px, -1px) rotate(1deg); }\n\t50% { -moz-transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { -moz-transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { -moz-transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { -moz-transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { -moz-transform: translate(2px, 2px) rotate(0deg); }\n\t100% { -moz-transform: translate(1px, -2px) rotate(-1deg); }\n}\n \n.shake {\n\t-webkit-animation-name: shakeit;\n\t-webkit-animation-duration: 0.8s;\n\t-webkit-transform-origin:50% 50%;\n\t-webkit-animation-iteration-count: infinite;\n\t-webkit-animation-timing-function: linear;\n  -moz-animation-name: shakeit;\n\t-moz-animation-duration: 0.8s;\n\t-moz-transform-origin:50% 50%;\n\t-moz-animation-iteration-count: infinite;\n\t-moz-animation-timing-function: linear;\n  -o-animation-name: shakeit;\n\t-o-animation-duration: 0.8s;\n\t-o-transform-origin:50% 50%;\n\t-o-animation-iteration-count: infinite;\n\t-o-animation-timing-function: linear;\n  animation-name: shakeit;\n\tanimation-duration: 0.8s;\n\ttransform-origin:50% 50%;\n\tanimation-iteration-count: infinite;\n\tanimation-timing-function: linear;\n}\n.shake {\n\t/*display:inline-block*/\n}</div><div tiddler="use arrowhead" tags="" modified="201405232044" created="201311011158" twine-position="10,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 20 + Math.ceil(Math.random()*10)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SLASH the spider with the arrowhead! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(8-$level)) eq 1&gt;&gt;The arrowhead is broken.&lt;&lt;silently&gt;&gt;&lt;&lt;set $arrowhead -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a Native American arrowhead]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="a pair of scissors" tags="" modified="201405262212" created="201405171721" twine-position="150,990" modifier="twee">&lt;&lt;if ($roomTracker is &quot;Miss Abigail's Room&quot; ) or ($roomTracker is &quot;Miss McKayla's Room&quot; ) or ($roomTracker is &quot;Mr. Shaquille's Room&quot; ) or ($roomTracker is &quot;Mr. Randy's Room&quot; ) or ($roomTracker is &quot;Mr. Remy's Room&quot; ) or ($roomTracker is &quot;Mr. Tubman's Room&quot; ) or ($roomTracker is &quot;Mr. Kelley's Room&quot; ) or ($roomTracker is &quot;Mr. Zeke's Room&quot; )&gt;&gt;\nUse the scissors to try to pry open the teacher's desk?\n@@margin:0 0 0 30px;[[Return]] @@ @@margin:0 0 0 30px;[[Use it|pry scissors]]@@\n&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try to use the scissors to hack away at the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;display &quot;Free Mr Kelley with scissors&quot;&gt;&gt;&lt;&lt;else&gt;&gt;You take the scissors out of your pocket, but you can't use them, so you put them back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="CSS" tags="stylesheet" modified="201405262224" created="201310071245" twine-position="430,10" modifier="twee">@font-face {font-family: 'Press Start 2P';src:url('PressStart2P-Regular.ttf') format('ttf');}@import url(http://fonts.googleapis.com/css?family=Press+Start+2P);\n@font-face {\n  font-family: 'Press Start 2P';\n  font-style: normal;\n  font-weight: 400;\n  src: local('Press Start 2P'), local('PressStart2P-Regular'), url(http://themes.googleusercontent.com/static/fonts/pressstart2p/v2/8Lg6LX8-ntOHUQnvQ0E7o2jf3WypfQQP02nP_ZmoBRo.woff) format('woff');\n}\n#passages {\n  position:relative;\n  width: 100%;\n  width: 100vw;\nmax-width:1280px !important;\n  margin:0 auto 0 auto;\n  padding:0;\n  border:0;\n  transition: height 2s; -webkit-transition:height 2s;\n\tfont-family: 'Press Start 2P', sans-serif !important;\n\tfont-size:12px;\n}\n.passage {\nfont-family: 'Press Start 2P', sans-serif !important;\n  width: 90vw;\n  width:90%;\n  color:white;\n  margin:0 auto 0 auto;\n  padding:2em 2.5em;\n  text-align:left;\n}\nli a.internalLink, li a.externalLink, #ss-submit{\n\tfont-family: 'Press Start 2P', sans-serif !important;\n}\na.internalLink, a.externalLink{\n  color:red;\n\tfont-family: 'Press Start 2P', sans-serif !important;\n}\na.internalLink:hover, a.externalLink:hover  {\n  color:yellow;\n}\n\n.passage blockquote {\n  border: 1px dashed gray;\n  padding: 1em;\n}\n.passage table{\nmargin:0 !important;\n}\n.header {\n  height: 0px;\ndisplay:none !important;\n}\nbody {\n  background-color:black;\n\tbackground-repeat:no-repeat;\n\tbackground-size:100%;\n  margin:10px;\n  padding:10px;\n\tfont-weight:bold;\n\ttext-shadow:3px 3px black;\n\tfont-family: 'Press Start 2P', sans-serif !important;\n}\n#sidebar {\ndisplay:none !important;\n  }\n\n.menu {\ndisplay:none !important;\n}\n\n#credits, #titleSeparator {\n  display:none !important;\n}\ntd, th\n{\npadding:10px 20px !important;\nborder:0 !important;\nfont-family: 'Press Start 2P', cursive !important;\n}\ntable{\nborder:0 !important;\n}\n}\nimg\n{\nborder:0 !important;\npadding:0 !important;\nmargin:0 !important;\n}\ninput[type=text]\n{\nfont-family: 'Press Start 2P', cursive !important;\n}\n@media screen and (max-width: 640px) {\n  .passage {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n  #share, #storyAuthor {\n    display:none !important;\n  }\n}\n/* Smartphones (portrait and landscape) ----------- */\n@media only screen \nand (min-device-width : 320px) \nand (max-device-width : 480px) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}\n\n/* Smartphones (landscape) ----------- */\n@media only screen \nand (min-width : 321px) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}\n\n/* Smartphones (portrait) ----------- */\n@media only screen \nand (max-width : 320px) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}\n\n/* iPads (portrait and landscape) ----------- */\n@media only screen \nand (min-device-width : 768px) \nand (max-device-width : 1024px) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}\n\n/* iPads (landscape) ----------- */\n@media only screen \nand (min-device-width : 768px) \nand (max-device-width : 1024px) \nand (orientation : landscape) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}\n\n/* iPads (portrait) ----------- */\n@media only screen \nand (min-device-width : 768px) \nand (max-device-width : 1024px) \nand (orientation : portrait) {\n#passages {\n    font-size: 1.25em !important;\nwidth:100%;\n  }\n}stylesheet</div><div tiddler="use tooth" tags="" modified="201405212214" created="201311011158" twine-position="570,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 15 + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You STAB the spider with the tooth. It's gross! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(9-$level)) eq 1&gt;&gt;You accidentally dropped the tooth and lost it.&lt;&lt;silently&gt;&gt;&lt;&lt;set $tooth -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a tooth]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="pry arrowhead" tags="" modified="201405180310" created="201405172108" twine-position="430,990" modifier="twee">&lt;&lt;set $diceroll = Math.ceil(Math.random() * 5)&gt;&gt;&lt;&lt;set $money = $money + $diceroll&gt;&gt;&lt;&lt;set $arrowhead -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a Native American arrowhead]]&quot;),1)&gt;&gt;You found $&lt;&lt;$diceroll&gt;&gt; in the teacher's desk. Unfortunately, you broke the arrowhead in the process.\n\n&lt;&lt;display &quot;Building A&quot;&gt;&gt;</div><div tiddler="cave0" tags="" modified="201405251506" created="201405180202" twine-position="150,430" modifier="twee">&lt;&lt;unmutesound &quot;track3.mp3&quot;&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;&lt;playsound &quot;sfx1.mp3&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;playsound &quot;sfx2.mp3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;SUDDENLY THE FLOOR COLLAPSES!!! You have fallen into a cave beneath the school! There's no way to climb out.\n&lt;&lt;display &quot;cave01&quot;&gt;&gt;&lt;&lt;set $level = 2&gt;&gt;&lt;&lt;set $firstaidkit = 1&gt;&gt;</div><div tiddler="StoryAuthor" tags="" modified="201310071239" created="201310071239" twine-position="290,10" modifier="twee">by Justin Riley</div><div tiddler="boss background" tags="" modified="201405202322" created="201405202226" twine-position="710,1830" modifier="twee">&lt;&lt;set $bossback = Math.ceil(Math.random()*9)&gt;&gt;&lt;&lt;if $bossback eq 1&gt;&gt;&lt;&lt;display &quot;peacockspider1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 2&gt;&gt;&lt;&lt;display &quot;peacockspider2&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 3&gt;&gt;&lt;&lt;display &quot;peacockspider3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 4&gt;&gt;&lt;&lt;display &quot;peacockspider4&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 5&gt;&gt;&lt;&lt;display &quot;peacockspider5&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 6&gt;&gt;&lt;&lt;display &quot;peacockspider6&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 7&gt;&gt;&lt;&lt;display &quot;peacockspider7&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 8&gt;&gt;&lt;&lt;display &quot;peacockspider8&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $bossback eq 9&gt;&gt;&lt;&lt;display &quot;peacockspider9&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Mr. Remy's Room" tags="" modified="201405232121" created="201310072326" twine-position="570,290" modifier="twee">&lt;&lt;setback rima8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Remy's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Remy's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Remy's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 5&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomKeyLocation eq 6&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 6) or ($randomKeyLocation+3 eq 7)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on his desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $bandaid eq 0&gt;&gt;\nSomeone's used [[bandaid]] is on the floor. It looks pretty gross.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Start" tags="" modified="201406081929" created="201310071213" twine-position="10,10" modifier="twee">&lt;img src=&quot;sundown3.gif&quot;&gt;\nby Justin Riley\n\nClick [[here|Name]] to begin\n&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;&lt;playsound &quot;sfx1.mp3&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;playsound &quot;sfx2.mp3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $points = 0&gt;&gt;\n&lt;&lt;set $roomCounter = 0&gt;&gt;\n&lt;&lt;set $scissors = 0&gt;&gt;\n&lt;&lt;set $armor = 0&gt;&gt;\n&lt;&lt;set $tooth = 0&gt;&gt;\n&lt;&lt;set $arrowhead = 0&gt;&gt;\n&lt;&lt;set $stapler = 0&gt;&gt;\n&lt;&lt;set $key = 0&gt;&gt;\n&lt;&lt;set $bandaid = 0&gt;&gt;\n&lt;&lt;set $tissues = 0&gt;&gt;\n&lt;&lt;set $gymsocks = 0&gt;&gt;\n&lt;&lt;set $hammer = 0&gt;&gt;\n&lt;&lt;set $randomKeyLocation = Math.ceil(Math.random() * 12)&gt;&gt;\n&lt;&lt;set $inv = [] &gt;&gt;\n&lt;&lt;set $money = 0&gt;&gt;\n&lt;&lt;set $health = 100&gt;&gt;\n&lt;&lt;set $enemyHealth = 20&gt;&gt;\n&lt;&lt;set $level = 1&gt;&gt;\n&lt;&lt;set $whacks = 0&gt;&gt;\n&lt;&lt;set $owlcall = 0&gt;&gt;\n&lt;&lt;set $attackpause = 5&gt;&gt;\n&lt;&lt;set $bossHealth = 100&gt;&gt;\n&lt;&lt;set $firstaidkit = 1&gt;&gt;\n&lt;&lt;set $hint = 1&gt;&gt;\n&lt;&lt;set $randomHint = Math.ceil(Math.random()*9)&gt;&gt;\n&lt;&lt;set $time = new Date().getTime()&gt;&gt;\n&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;&lt;set $punch = 5&gt;&gt;&lt;&lt;set $kick = 1&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;set $punch = 1&gt;&gt;&lt;&lt;set $kick = 5&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Mr. Kelley's Room" tags="" modified="201405232123" created="201310072327" twine-position="850,290" modifier="twee">&lt;&lt;setback kelly8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Kelley's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Kelley's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Kelley's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 9&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $randomKeyLocation eq 10&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 10) or ($randomKeyLocation+3 eq 11)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on his desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $gymsocks eq 0&gt;&gt;\nSomeone's sweaty [[gym socks]] are on the floor. They smell really bad.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="winged alates" tags="" modified="201405240025" created="201405240018" twine-position="1270,1550" modifier="twee">&quot;An alate flying ant, or princess, is a winged, young queen. Princesses take to the skies to mate on a warm, humid summers day also known as the nuptial flight. Once mated, they scurry along the ground to find a suitable nesting place to lay their eggs.&quot;\n\n&quot;Several species of spider including Achaearanea Wau and Anelosimus Eximius swarm in an analogous way to ants, bees and wasps.&quot;\n\n&lt;&lt;return&gt;&gt;</div><div tiddler="scissors" tags="" modified="201406082105" created="201310072304" twine-position="150,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $scissors = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a pair of scissors]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the scissors and put them in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="forms" tags="script" modified="201405222316" created="201405222315" twine-position="1270,10" modifier="twee">// Places the variables (given as parameters) into the Google Forms text input field.\nmacros['googleForms'] = \n{\n\thandler: function (place, macroName, params, parser)\n\t{\n\t\t//Enter the ID of the first Google Forms text input field here.\n\t\ta = place.querySelector(&quot;#entry_892881495&quot;);\n\t\ta.value = eval(Wikifier.parse(params[0]));\n\t\t//Enter the ID of the second Google Forms text input field here.\n\t\tb = place.querySelector(&quot;#entry_515172766&quot;);\n\t\tb.value = eval(Wikifier.parse(params[1]));\n\t}\n};\n</div><div tiddler="you have" tags="" modified="201310312343" created="201310312343" twine-position="990,150" modifier="twee">&lt;&lt;if $inv.length gt 0&gt;&gt;\nYou have:&lt;&lt;print $inv&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="Mr. Randy's Room" tags="" modified="201405232121" created="201310072312" twine-position="430,290" modifier="twee">&lt;&lt;setback shazia8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr. Randy's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*5) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Mr. Randy's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Mr. Randy's Room. It is still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 4&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on his desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 4) or ($randomKeyLocation+3 eq 5)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on his desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stapler eq 0&gt;&gt;\nThere is a [[stapler]] on his desk.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="fight" tags="" modified="201405182326" created="201311011151" twine-position="10,710" modifier="twee">&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*2) eq 1&gt;&gt;&lt;&lt;playsound &quot;sfx1.mp3&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;playsound &quot;sfx2.mp3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\nA giant spider crawls out of the shadows!\n&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;</div><div tiddler="use owl call" tags="" modified="201405212217" created="201405190110" twine-position="1410,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 24 + Math.ceil(Math.random()*26)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;&lt;img src=&quot;owl.gif&quot;&gt;\nA MAJESTIC OWL SWOOPS IN AND SLASHES THE SPIDER WITH ITS TALONS. //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if ($level gt 2) and (Math.ceil(Math.random()*(2+$level)) eq 1)&gt;&gt;You accidentally dropped the owl call and lost it.&lt;&lt;silently&gt;&gt;&lt;&lt;set $owlcall -= 2&gt;&gt;&lt;&lt;set $inv.push(&quot; [[an owl call]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="an ant-like swarm" tags="" modified="201405240018" created="201405190047" twine-position="850,1690" modifier="twee">&quot;An ant-like swarm?&quot; you say interupting him.\n\n&quot;That's right,&quot; Mr. Kelley replies. &quot;With [[workers]], [[soldiers]], [[winged alates]], and [[a queen]].&quot;</div><div tiddler="heal" tags="" modified="201405232122" created="201405180310" twine-position="850,710" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[someone's used bandaid]]&quot;),1)&gt;&gt;&lt;&lt;set $heal = 25 + Math.ceil(Math.random()*25)&gt;&gt;&lt;&lt;set $points+=$heal&gt;&gt;&lt;&lt;set $health += $heal&gt;&gt;//+&lt;&lt;$heal&gt;&gt; health//&lt;&lt;endif&gt;&gt;\n[[Continue]]</div><div tiddler="someone's used bandaid" tags="" modified="201405262212" created="201405172021" twine-position="850,990" modifier="twee">&lt;&lt;if $health lt 200&gt;&gt;Your health is at &lt;&lt;$health&gt;&gt;. Would you like to put the bandaid on your spider bites?\n@@margin:0 0 0 30px;[[Return]] @@ @@margin:0 0 0 30px;[[Use it|heal]]@@\n&lt;&lt;else&gt;&gt;\nYou take the used bandaid out of your pocket, but you can't use it right now, so you put it back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;</div><div tiddler="boss hit" tags="" modified="201405251436" created="201405202228" twine-position="850,1830" modifier="twee">&lt;&lt;if $bossHealth gt 0&gt;&gt;&lt;&lt;set $enemyHit = Math.ceil(Math.random()*10)+Math.ceil(Math.random()*10)&gt;&gt;&lt;&lt;set $points += $enemyHit*2&gt;&gt;@@color:red;THE SPIDER QUEEN BITES YOU! //-&lt;&lt;$enemyHit&gt;&gt;//@@&lt;&lt;set $health -= $enemyHit&gt;&gt;\nYou have &lt;&lt;$health&gt;&gt; health.\n&lt;&lt;if $health gt 0&gt;&gt;&lt;&lt;display &quot;use weapon&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;died&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;YOU HAVE DEFEATED THE SPIDER QUEEN! //+1000 pts//\n[[Continue|You Win]]&lt;&lt;set $points += 1000&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="peacockspider5" tags="" modified="201405202321" created="201405202319" twine-position="850,430" modifier="twee">&lt;&lt;setback peacockspider5.gif&gt;&gt;</div><div tiddler="use stapler" tags="" modified="201405212214" created="201311011158" twine-position="290,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 15 + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SHOOT STAPLES at the spider! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(9-$level)) eq 1&gt;&gt;You're out of staples.&lt;&lt;silently&gt;&gt;&lt;&lt;set $stapler -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a stapler]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="sound Macros" tags="script" modified="201405182257" created="201405182257" twine-position="1130,290" modifier="twee">(function () {\n  &quot;use strict&quot;;\n  version.extensions['soundMacros'] = {\n    major: 1,\n    minor: 1,\n    revision: 2\n  };\n  var p = macros['playsound'] = {\n    soundtracks: {},\n    handler: function (a, b, c, d) {\n      var loop = function (m) {\n          if (m.loop == undefined) {\n            m.loopfn = function () {\n              this.play();\n            };\n            m.addEventListener('ended', m.loopfn, 0);\n          } else m.loop = true;\n          m.play();\n          };\n      var s = eval(d.fullArgs());\n      if (s) {\n        s = s.toString();\n        var m = this.soundtracks[s.slice(0, s.lastIndexOf(&quot;.&quot;))];\n        if (m) {\n          if (b == &quot;playsound&quot;) {\n            m.play();\n          } else if (b == &quot;loopsound&quot;) {\n            loop(m);\n          } else if (b == &quot;pausesound&quot;) {\n            m.pause();\n          } else if (b == &quot;unloopsound&quot;) {\n            if (m.loop != undefined) {\n              m.loop = false;\n            } else if (m.loopfn) {\n              m.removeEventListener('ended', m.loopfn);\n              delete m.loopfn;\n            }\n          } else if (b == &quot;stopsound&quot;) {\n            m.pause();\n            m.currentTime = 0;\n} else if (b == &quot;mutesound&quot;) {\n            m.volume = 0;\n} else if (b == &quot;unmutesound&quot;) {\n            m.volume = 1;\n          } else if (b == &quot;fadeoutsound&quot; || b == &quot;fadeinsound&quot;) {\n            if (m.interval) clearInterval(m.interval);\n            if (b == &quot;fadeinsound&quot;) {\n              if (m.currentTime&gt;0) return;\n              m.volume = 0;\n              loop(m);\n            } else {\n              if (!m.currentTime) return;\n              m.play();\n            }\n            var v = m.volume;\n            m.interval = setInterval(function () {\n              v = Math.min(1, Math.max(0, v + 0.005 * (b == &quot;fadeinsound&quot; ? 1 : -1)));\n              m.volume = Math.easeInOut(v);\n              if (v == 0 || v == 1) clearInterval(m.interval);\n              if (v == 0) {\n                m.pause();\n                m.currentTime = 0;\n                m.volume = 1;\n              }\n            }, 10);\n          }\n        }\n      }\n    }\n  }\n  macros['fadeinsound'] = p;\n  macros['fadeoutsound'] = p;\n  macros['unloopsound'] = p;\n  macros['loopsound'] = p;\n  macros['pausesound'] = p;\n  macros['stopsound'] = p;\n  macros['mutesound'] = p;\n  macros['unmutesound'] = p;\n  macros['stopallsound'] = {\n    handler: function () {\n      var s = macros.playsound.soundtracks;\n      for (var j in s) {\n\t\tif (s.hasOwnProperty(j)) {\n          s[j].pause();\n          if (s[j].currentTime) {\n\t\t    s[j].currentTime = 0;\n\t\t  }\n\t\t}\n      }\n    }\n  }\n  var div = document.getElementById(&quot;storeArea&quot;).firstChild;\n  var fe = [&quot;ogg&quot;, &quot;mp3&quot;, &quot;m4a&quot;, &quot;wav&quot;, &quot;webm&quot;];\n  while (div) {\n    var b = String.fromCharCode(92);\n    var q = '&quot;';\n    var re = &quot;['&quot; + q + &quot;]([^&quot; + q + &quot;']*?)&quot; + b + &quot;.(ogg|mp3|m4a|wav|webm)['&quot; + q + &quot;]&quot;;\n    k(new RegExp(re, &quot;gi&quot;));\n    div = div.nextSibling;\n  }\n\n  function k(c, e) {\n    do {\n      var d = c.exec(div.innerHTML);\n      if (d) {\n        var a = new Audio();\n        if (a.canPlayType) {\n          for (var i = -1; i &lt; fe.length; i += 1) {\n            if (i &gt;= 0) d[2] = fe[i];\n            if (a.canPlayType(&quot;audio/&quot; + d[2])) break;\n          }\n          if (i &lt; fe.length) {\n            a.setAttribute(&quot;src&quot;, d[1] + &quot;.&quot; + d[2]);\n            a.interval = null;\n            macros.playsound.soundtracks[d[1]] = a;\n          } else console.log(&quot;Browser can't play '&quot; + d[1] + &quot;'&quot;);\n        }\n      }\n    } while (d);\n  }\n}());</div><div tiddler="a sledge hammer" tags="" modified="201405261524" created="201405182309" twine-position="1270,990" modifier="twee">&lt;&lt;if $roomTracker eq &quot;Mr Kelley tied up&quot;&gt;&gt;You try using the sledge hammer to pry apart the silk, but it's no use. Maybe you could try to use something sharp to cut through the rope-like silk? [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker eq &quot;cave12&quot;&gt;&gt;&lt;&lt;if $whacks eq 2&gt;&gt;CRUNCH! You whack the boulder with the sledge hammer and the entire boulder crumbles!\n[[Continue through the tunnel|cave13]]&lt;&lt;set $whacks +=1&gt;&gt;&lt;&lt;unmutesound &quot;track5.mp3&quot;&gt;&gt;&lt;&lt;set $level = 3&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $whacks eq 1&gt;&gt;CRASH! You whack the boulder with the sledge hammer and a large chunk of it breaks off. One more good hit should break it apart!\n&lt;&lt;display &quot;cave12&quot;&gt;&gt;&lt;&lt;set $whacks +=1&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $whacks eq 0&gt;&gt;CLANG! You whack the boulder with the sledge hammer and a small crack appears.\n&lt;&lt;display &quot;cave12&quot;&gt;&gt;&lt;&lt;set $whacks +=1&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;\nYou try banging the sledge hammer on everything, but nothing happens.\n[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="the colony is pretty much doomed" tags="" modified="201405232127" created="201405190056" twine-position="1130,1690" modifier="twee">&quot;Queen ants are the largest in the colony,&quot; he adds. &quot;They're about double the size of the smallest minor workers and significantly larger than the major workers. Her third segment is notably longer and fatter than her second segment, all the better with which to lay eggs.&quot;\n\n&quot;She'll be easy to spot, but not-so-easy to defeat,&quot; you acknowledge.\n\n&quot;[[Take this]],&quot; says Mr. Kelley.</div><div tiddler="tissues" tags="" modified="201406082106" created="201310082146" twine-position="990,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $tissues = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[some snot-filled tissues]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the tissues and put them in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="setback Macro" tags="script" modified="201405171604" created="201405171519" twine-position="1130,10" modifier="twee">//changes the background image\nmacros['setback'] =\n{\nhandler: function (place, macroName, params, parser)\n{\ndocument.body.style.backgroundImage = 'url('+params[0]+')';\n}\n};</div><div tiddler="peacockspider4" tags="" modified="201405202321" created="201405202319" twine-position="710,430" modifier="twee">&lt;&lt;setback peacockspider4.gif&gt;&gt;</div><div tiddler="peacockspider7" tags="" modified="201405202320" created="201405202320" twine-position="1130,430" modifier="twee">&lt;&lt;setback peacockspider7.gif&gt;&gt;</div><div tiddler="peacockspider6" tags="" modified="201405202321" created="201405202320" twine-position="990,430" modifier="twee">&lt;&lt;setback peacockspider6.gif&gt;&gt;</div><div tiddler="peacockspider1" tags="" modified="201405202318" created="201405202317" twine-position="290,430" modifier="twee">&lt;&lt;setback peacockspider1.gif&gt;&gt;</div><div tiddler="Mr Kelley tied up" tags="" modified="201405232125" created="201405182327" twine-position="150,1690" modifier="twee">&lt;&lt;setback&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;The spider silk is sticky and very strong. Mr. Kelley is mumbling something but his mouth is covered and you can't understand.\n\n[[Try to tear apart the spider silk|Silk]]\n[[Tell Mr. Kelley, &quot;I'll come back & save you later&quot;|cave14]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="peacockspider3" tags="" modified="201405202321" created="201405202319" twine-position="570,430" modifier="twee">&lt;&lt;setback peacockspider3.gif&gt;&gt;</div><div tiddler="peacockspider2" tags="" modified="201405202321" created="201405202318" twine-position="430,430" modifier="twee">&lt;&lt;setback peacockspider2.gif&gt;&gt;</div><div tiddler="peacockspider9" tags="" modified="201405202320" created="201405202320" twine-position="1410,430" modifier="twee">&lt;&lt;setback peacockspider9.gif&gt;&gt;</div><div tiddler="enemy hit" tags="" modified="201405230014" created="201405180003" twine-position="430,710" modifier="twee">&lt;&lt;if $enemyHealth gt 0&gt;&gt;&lt;&lt;set $enemyHit = Math.ceil(Math.random()*3)+Math.ceil(Math.random()*3)&gt;&gt;@@color:red;THE SPIDER BITES YOU! //-&lt;&lt;$enemyHit&gt;&gt;//@@&lt;&lt;set $health -= $enemyHit&gt;&gt;&lt;&lt;set $points += $enemyHit&gt;&gt;\nYou have &lt;&lt;$health&gt;&gt; health.\n&lt;&lt;if $health gt 0&gt;&gt;&lt;&lt;display &quot;use weapon&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;died&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;You have defeated the spider. //+100 pts//\n[[Continue]]&lt;&lt;endif&gt;&gt;</div><div tiddler="arrowhead" tags="" modified="201406082104" created="201310081324" twine-position="10,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $arrowhead = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a Native American arrowhead]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the arrowhead and put it in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="a stapler" tags="" modified="201405261523" created="201405171725" twine-position="290,990" modifier="twee">&lt;&lt;if $roomTracker eq &quot;Mr Kelley tied up&quot;&gt;&gt;You try using the stapler to pry apart the silk, but it's just too strong. Maybe you could try to use something sharp to cut through the rope-like silk? [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try smacking the stapler against the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;\nYou take the stapler out of your pocket, but you can't use it, so you put it back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="You Win" tags="" modified="201405251448" created="201405202230" twine-position="1270,1830" modifier="twee">&lt;&lt;stopallsound&gt;&gt;&lt;&lt;loopsound &quot;youwin.mp3&quot;&gt;&gt;&lt;&lt;setback youwin.gif&gt;&gt;@@color:#00FF00;font-size:20px;You have saved Sundown Academy from the evil spiders!\nAs a reward, you have been named &quot;STUDENT OF THE MONTH&quot;\nGreat job &lt;&lt;$name&gt;&gt;!\n\n&lt;&lt;display &quot;score&quot;&gt;&gt;@@</div><div tiddler="pick1" tags="" modified="201405262222" created="201310072247" twine-position="710,150" modifier="twee">Where would you like to go?\n|&lt;&lt;if passage() neq &quot;Miss Abigail's Room&quot;&gt;&gt;[[Miss Abigail's Room]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if passage() neq &quot;Miss McKayla's Room&quot;&gt;&gt;[[Miss McKayla's Room]]&lt;&lt;endif&gt;&gt;|\n|&lt;&lt;if passage() neq &quot;Mr. Shaquille's Room&quot;&gt;&gt;[[Mr. Shaquille's Room]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if passage() neq &quot;Mr. Randy's Room&quot;&gt;&gt;[[Mr. Randy's Room]]&lt;&lt;endif&gt;&gt;|\n|&lt;&lt;if passage() neq &quot;Mr. Remy's Room&quot;&gt;&gt;[[Mr. Remy's Room]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if passage() neq &quot;Mr. Tubman's Room&quot;&gt;&gt;[[Mr. Tubman's Room]]&lt;&lt;endif&gt;&gt;|\n|&lt;&lt;if passage() neq &quot;Mr. Kelley's Room&quot;&gt;&gt;[[Mr. Kelley's Room]]&lt;&lt;endif&gt;&gt;|&lt;&lt;if passage() neq &quot;Mr. Zeke's Room&quot;&gt;&gt;[[Mr. Zeke's Room]]&lt;&lt;endif&gt;&gt;|\n&lt;&lt;if $key gt 0&gt;&gt;|[[Principal Redwood's Office]]||&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;you have&quot;&gt;&gt;</div><div tiddler="peacockspider8" tags="" modified="201405202320" created="201405202320" twine-position="1270,430" modifier="twee">&lt;&lt;setback peacockspider8.gif&gt;&gt;</div><div tiddler="Take this" tags="" modified="201405202246" created="201405190102" twine-position="1270,1690" modifier="twee">Mr. Kelley hands you a wooden whistle.\n\nYou look at it with a puzzled expression.\n\n&quot;It's an OWL CALL,&quot; says Mr. Kelley. &quot;Owls //love// to eat spiders.&quot;\n\nYou finish cutting Mr. Kelley free and [[continue down the tunnel|cave14]].&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $owlcall = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[an owl call]]&quot;)&gt;&gt;&lt;&lt;set $points += 1000&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Silk" tags="" modified="201405251436" created="201405190012" twine-position="570,1830" modifier="twee">You try to pull apart the silk as hard as you can, but it's just too strong. Maybe you could try to use something sharp to cut through the rope-like silk?\n[[Return]]</div><div tiddler="use scissors" tags="" modified="201405232044" created="201311011157" twine-position="150,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = 20 + Math.ceil(Math.random()*10)&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You SLASH the spider with the scissors! //-&lt;&lt;$hit&gt;&gt;//\n&lt;&lt;if Math.ceil(Math.random()*(8-$level)) eq 1&gt;&gt;The scissors are broken.&lt;&lt;silently&gt;&gt;&lt;&lt;set $scissors -= 2&gt;&gt;&lt;&lt;set $inv.splice($inv.indexOf(&quot; [[a pair of scissors]]&quot;),1)&gt;&gt;&lt;&lt;endsilently&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave12" tags="" modified="201405232058" created="201405180207" twine-position="150,1410" modifier="twee">&lt;&lt;setback cavepanorama12.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave12&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;\nThere is a large boulder blocking the path ahead. You could probably break it apart if you used the right tool.\nThere are two un-blocked tunnels. Which way do you want to go?\n\n[[Left|cave09]]\n[[Right|cave11]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave13" tags="" modified="201405232124" created="201405190006" twine-position="10,1690" modifier="twee">&lt;&lt;setback&gt;&gt;There is something strange ahead in the tunnel. It looks like a caterpillar or a mummy or something...\n\nAs you get closer you realize that it's Mr. Kelley, the science teacher! He has been tied up with spider silk!\n\n[[&quot;Don't worry Mr. Kelley, I'm gonna rescue you!&quot;|Mr Kelley tied up]]</div><div tiddler="cave10" tags="" modified="201405251350" created="201405180207" twine-position="850,1550" modifier="twee">&lt;&lt;setback cavepanorama10.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave10&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 10&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 7) or ($randomKeyLocation eq 8)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation eq 5) or ($randomKeyLocation eq 6) or ($randomKeyLocation eq 2)&gt;&gt;&lt;&lt;if $hint eq 1&gt;&gt;There is a [[piece of paper|hint]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave08]]\n[[Right|cave07]]\n[[Middle|cave03]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave11" tags="" modified="201405232055" created="201405180207" twine-position="290,1270" modifier="twee">&lt;&lt;setback cavepanorama11.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave11&quot;&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*4) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $randomKeyLocation eq 11&gt;&gt;&lt;&lt;if $hammer eq 0&gt;&gt;There is a large [[sledge hammer]] on the floor.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;There are three tunnels. Which way do you want to go?\n\n[[Left|cave12]]\n[[Right|cave06]]\n[[Middle|cave05]]\n\n&lt;&lt;display &quot;you have&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="cave16" tags="" modified="201405202125" created="201405202122" twine-position="290,1830" modifier="twee">&lt;&lt;setback cave16.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave16&quot;&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;</div><div tiddler="Name" tags="" modified="201405311741" created="201405182247" twine-position="10,150" modifier="twee">&lt;&lt;loopsound &quot;track1.mp3&quot;&gt;&gt;&lt;&lt;loopsound &quot;track2.mp3&quot;&gt;&gt;&lt;&lt;loopsound &quot;track3.mp3&quot;&gt;&gt;&lt;&lt;loopsound &quot;track4.mp3&quot;&gt;&gt;&lt;&lt;loopsound &quot;track5.mp3&quot;&gt;&gt;&lt;&lt;mutesound &quot;track5.mp3&quot;&gt;&gt;&lt;&lt;mutesound &quot;track4.mp3&quot;&gt;&gt;&lt;&lt;mutesound &quot;track3.mp3&quot;&gt;&gt;&lt;&lt;mutesound &quot;track2.mp3&quot;&gt;&gt;&lt;&lt;set $name = prompt(&quot;What's your name?&quot;)&gt;&gt;&lt;&lt;display &quot;Building A&quot;&gt;&gt;</div><div tiddler="cave14" tags="" modified="201405202317" created="201405190013" twine-position="10,1830" modifier="twee">&lt;&lt;setback cave14.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave14&quot;&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;</div><div tiddler="cave15" tags="" modified="201405202318" created="201405202121" twine-position="150,1830" modifier="twee">&lt;&lt;setback cave15.jpg&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;set $roomTracker = &quot;cave15&quot;&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;</div><div tiddler="use kick" tags="" modified="201405202347" created="201405172346" twine-position="710,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = $kick + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*8) eq 1&gt;&gt;You tried to KICK to but you missed!&lt;&lt;else&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You KICK the spider! //-&lt;&lt;$hit&gt;&gt;//&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="use weapon" tags="" modified="201405262128" created="201311010925" twine-position="150,710" modifier="twee">@@margin:0 0 0 30px;[[Punch|use punch]] @@ @@margin:0 0 0 30px;[[Kick|use kick]] @@ &lt;&lt;if $scissors gt 0&gt;&gt;@@margin:0 0 0 30px;[[Scissors|use scissors]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $arrowhead gt 0&gt;&gt;@@margin:0 0 0 30px;[[Arrowhead|use arrowhead]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $stapler gt 0&gt;&gt;@@margin:0 0 0 30px;[[Stapler|use stapler]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $tooth gt 0&gt;&gt;@@margin:0 0 0 30px;[[Tooth|use tooth]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $tissues gt 0&gt;&gt;@@margin:0 0 0 30px;[[Tissues|use tissues]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $bandaid gt 0&gt;&gt;@@margin:0 0 0 30px;[[Bandaid|use bandaid]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $gymsocks gt 0&gt;&gt;@@margin:0 0 0 30px;[[Socks|use gym socks]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $hammer gt 0&gt;&gt;@@margin:0 0 0 30px;[[Hammer|use sledge hammer]] @@ &lt;&lt;endif&gt;&gt;&lt;&lt;if $owlcall gt 0&gt;&gt;@@margin:0 0 0 30px;[[Owl Call|use owl call]] @@ &lt;&lt;endif&gt;&gt;</div><div tiddler="Continue" tags="" modified="201405202317" created="201405180049" twine-position="710,710" modifier="twee">&lt;&lt;set $enemyHealth = $roomCounter * 2.5&gt;&gt;&lt;&lt;if $level eq 1&gt;&gt;&lt;&lt;set $attackpause = $roomCounter+3&gt;&gt;&lt;&lt;setback buildinga8bit.jpg&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\nYou are standing in the hallway of Building A at Sundown Academy.\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $level eq 2&gt;&gt;&lt;&lt;set $attackpause = $roomCounter+2&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave01&quot;&gt;&gt;&lt;&lt;display &quot;cave01&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave02&quot;&gt;&gt;&lt;&lt;display &quot;cave02&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave03&quot;&gt;&gt;&lt;&lt;display &quot;cave03&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave04&quot;&gt;&gt;&lt;&lt;display &quot;cave04&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave05&quot;&gt;&gt;&lt;&lt;display &quot;cave05&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave06&quot;&gt;&gt;&lt;&lt;display &quot;cave06&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave07&quot;&gt;&gt;&lt;&lt;display &quot;cave07&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave08&quot;&gt;&gt;&lt;&lt;display &quot;cave08&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave09&quot;&gt;&gt;&lt;&lt;display &quot;cave09&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave10&quot;&gt;&gt;&lt;&lt;display &quot;cave10&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave11&quot;&gt;&gt;&lt;&lt;display &quot;cave11&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;&lt;&lt;display &quot;cave12&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;display &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $level eq 3&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;display &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave16&quot;&gt;&gt;&lt;&lt;display &quot;cave17&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave15&quot;&gt;&gt;&lt;&lt;display &quot;cave16&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave14&quot;&gt;&gt;&lt;&lt;display &quot;cave15&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Return" tags="" modified="201405190004" created="201405181459" twine-position="990,710" modifier="twee">&lt;&lt;if $roomTracker is &quot;Building A&quot;&gt;&gt;&lt;&lt;display &quot;Building A&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Miss Abigail's Room&quot;&gt;&gt;&lt;&lt;display &quot;Miss Abigail's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Miss McKayla's Room&quot;&gt;&gt;&lt;&lt;display &quot;Miss McKayla's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Shaquille's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Shaquille's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Randy's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Randy's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Remy's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Remy's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Tubman's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Tubman's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Kelley's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Kelley's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr. Zeke's Room&quot;&gt;&gt;&lt;&lt;display &quot;Mr. Zeke's Room&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave01&quot;&gt;&gt;&lt;&lt;display &quot;cave01&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave02&quot;&gt;&gt;&lt;&lt;display &quot;cave02&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave03&quot;&gt;&gt;&lt;&lt;display &quot;cave03&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave04&quot;&gt;&gt;&lt;&lt;display &quot;cave04&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave05&quot;&gt;&gt;&lt;&lt;display &quot;cave05&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave06&quot;&gt;&gt;&lt;&lt;display &quot;cave06&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave07&quot;&gt;&gt;&lt;&lt;display &quot;cave07&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave08&quot;&gt;&gt;&lt;&lt;display &quot;cave08&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave09&quot;&gt;&gt;&lt;&lt;display &quot;cave09&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave10&quot;&gt;&gt;&lt;&lt;display &quot;cave10&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave11&quot;&gt;&gt;&lt;&lt;display &quot;cave11&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;&lt;&lt;display &quot;cave12&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;display &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="use punch" tags="" modified="201405202347" created="201405172346" twine-position="430,850" modifier="twee">&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss background&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy image&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $hit = $punch + Math.ceil(Math.random()*6)&gt;&gt;&lt;&lt;if Math.ceil(Math.random()*8) eq 1&gt;&gt;You tried to PUNCH it but you missed!&lt;&lt;else&gt;&gt;&lt;&lt;set $bossHealth -= $hit&gt;&gt;&lt;&lt;set $enemyHealth -= $hit&gt;&gt;&lt;&lt;set $points += $hit&gt;&gt;You PUNCH the spider! //-&lt;&lt;$hit&gt;&gt;//&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $level is 4&gt;&gt;&lt;&lt;display &quot;boss hit&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;enemy hit&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="died" tags="" modified="201405222320" created="201405180025" twine-position="570,710" modifier="twee">You died.\n\nTHE END\n\n&lt;&lt;display &quot;score&quot;&gt;&gt;</div><div tiddler="a Native American arrowhead" tags="" modified="201405262211" created="201403260039" twine-position="10,990" modifier="twee">&lt;&lt;if ($roomTracker is &quot;Miss Abigail's Room&quot; ) or ($roomTracker is &quot;Miss McKayla's Room&quot; ) or ($roomTracker is &quot;Mr. Shaquille's Room&quot; ) or ($roomTracker is &quot;Mr. Randy's Room&quot; ) or ($roomTracker is &quot;Mr. Remy's Room&quot; ) or ($roomTracker is &quot;Mr. Tubman's Room&quot; ) or ($roomTracker is &quot;Mr. Kelley's Room&quot; ) or ($roomTracker is &quot;Mr. Zeke's Room&quot; )&gt;&gt;\nUse the arrowhead to try to open the teacher's desk?\n@@margin:0 0 0 30px;[[Return]] @@ @@margin:0 0 0 30px;[[Use it|pry arrowhead]] @@\n&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;cave12&quot;&gt;&gt;You try to use the arrowhead to chip away at the boulder but it's no use. You need to hit the boulder with something big and heavy!&lt;&lt;if $hammer is 0&gt;&gt; Keep exploring the cave and maybe you'll find something!&lt;&lt;endif&gt;&gt; [[Return]]&lt;&lt;else&gt;&gt;&lt;&lt;if $roomTracker is &quot;Mr Kelley tied up&quot;&gt;&gt;&lt;&lt;display &quot;Free Mr Kelley with arrowhead&quot;&gt;&gt;&lt;&lt;else&gt;&gt;You take the Native American arrowhead out of your pocket. You can't use it, so you put it back in your pocket.[[Return]]\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Miss McKayla's Room" tags="" modified="201405232120" created="201310072310" twine-position="150,290" modifier="twee">&lt;&lt;setback mccall8bit.jpg&gt;&gt;&lt;&lt;set $roomTracker = &quot;Miss McKayla's Room&quot;&gt;&gt;&lt;&lt;set $roomCounter += 1&gt;&gt;&lt;&lt;if ($roomCounter gt $attackpause) and (Math.ceil(Math.random()*5) eq 1)&gt;&gt;&lt;&lt;display &quot;fight&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;shakey&quot;&gt;&gt;\n&lt;&lt;once&gt;&gt;Miss McKayla's Room is empty.&lt;&lt;becomes&gt;&gt;You are back in Miss McKayla's Room and it's still empty.&lt;&lt;endonce&gt;&gt;\n&lt;&lt;if $randomKeyLocation eq 2&gt;&gt;&lt;&lt;if $key eq 0&gt;&gt;\nThere is a large [[key]] on her desk.\n&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if ($randomKeyLocation+3 eq 14) or ($randomKeyLocation+3 eq 15)&gt;&gt;&lt;&lt;if $firstaidkit eq 1&gt;&gt;There is a [[first aid kit]] on her desk.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $arrowhead eq 0&gt;&gt;\nThere is a Native American [[arrowhead]] on her desk.\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;pick1&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="tooth" tags="" modified="201406082105" created="201310081323" twine-position="570,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $tooth = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[a tooth]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the tooth and put it in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="armor" tags="" modified="201405202038" created="201310072340" twine-position="430,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $armor = 1&gt;&gt;&lt;&lt;set $health += 50&gt;&gt;&lt;&lt;set $inv.push(&quot; a coat of armor&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou put on the medival coat of armor. Fortunately, it fits! This should help protect you. You walk out of the room. *CLANG CLANG CLANG*&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;Building A&quot;&gt;&gt;</div><div tiddler="bandaid" tags="" modified="201406082106" created="201310082141" twine-position="850,570" modifier="twee">&lt;&lt;if visited(passage()) eq 1&gt;&gt;&lt;&lt;silently&gt;&gt;&lt;&lt;set $bandaid = 1&gt;&gt;&lt;&lt;set $inv.push(&quot; [[someone's used bandaid]]&quot;)&gt;&gt;&lt;&lt;endsilently&gt;&gt;\nYou pick up the bandaid and put it in your pocket.\n[[Return]]&lt;&lt;set $points += 100&gt;&gt;&lt;&lt;endif&gt;&gt;</div></div></body></html>
